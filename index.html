<!DOCTYPE html>
<!-- 
╔══════════════════════════════════════════════════════════════════╗
║                Sistema "Valutare l'Invisibile" v4.0              ║
║                                                                  ║
║  Autore: Mirella Colangelo                                       ║
║  Organizzazione: DigitalCrazyCompany                             ║
║  Anno: 2025                                                      ║             
║  Sistema di valutazione inclusiva per studenti disturbi specifici║
║  dell'apprendimento e con disalilità ispirato ai principi di     ║
║  Black & Wiliam per la valutazione formativa e progettato        ║
║  secondo i principi UDL.                                         ║
║                                                                  ║
║  Licenza: Creative Commons BY-NC-SA 4.0                          ║
║  Repository: https://github.com/MckDave/valutare-invisibile      ║   
║                                                                  ║
║  Per citazioni accademiche:                                      ║
║  Mirella Colangelo (2025)                                        ║
║  Sistema Valutativo "Valutare l'Invisibile"                      ║
║  https://github.com/MckDave/valutare_invisibile                  ║
║  email: mir[at]digitalcrazycompany.it                            ║
╚══════════════════════════════════════════════════════════════════╝
-->
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Valutativo Inclusivo - Valutare l'Invisibile</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a237e 50%, #3f51b5 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #1a237e;
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 16px;
        }
        
        .main-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }
        
        .sidebar {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .content-area {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            min-height: 600px;
        }
        
        .student-info {
            margin-bottom: 30px;
        }
        
        .student-info input, .student-info select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 14px;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }
        
        .student-info input:focus, .student-info select:focus {
            outline: none;
            border-color: #3f51b5;
        }
        
        .student-info label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 30px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .nav-tab {
            background: none;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .nav-tab.active {
            color: #3f51b5;
            border-bottom-color: #3f51b5;
        }
        
        .nav-tab:hover {
            background: rgba(63,81,181,0.1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .competenza-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .competenza-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3f51b5;
            display: flex;
            align-items: center;
        }
        
        .competenza-section h3 .emoji {
            font-size: 24px;
            margin-right: 10px;
        }
        
        .competenza-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .competenza-item label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: #34495e;
        }
        
        .range-input {
            width: 100%;
            margin-bottom: 10px;
            accent-color: #3f51b5;
        }
        
        .range-value {
            text-align: center;
            font-weight: bold;
            padding: 8px;
            border-radius: 20px;
            font-size: 14px;
            color: white;
        }
        
        .level-1 { background: #e74c3c; }
        .level-2 { background: #f39c12; }
        .level-3 { background: #f1c40f; color: #333; }
        .level-4 { background: #27ae60; }
        
        .disability-specific {
            background: #e8f4fd;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .disability-specific h4 {
            color: #2980b9;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .micro-progress {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .progress-phase {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .progress-phase.selected {
            border-color: #3f51b5;
            background: #f0f4ff;
        }
        
        .progress-phase h5 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        .progress-phase p {
            font-size: 11px;
            color: #666;
            line-height: 1.3;
        }
        
        .observations {
            background: #fff3cd;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .observations h4 {
            color: #856404;
            margin-bottom: 15px;
        }
        
        .observations textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ffeaa7;
            border-radius: 10px;
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }
        
        .portfolio-section {
            background: #d1ecf1;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .portfolio-section h4 {
            color: #0c5460;
            margin-bottom: 20px;
        }
        
        .portfolio-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #17a2b8;
        }
        
        .portfolio-item input, .portfolio-item textarea, .portfolio-item select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .file-upload {
            border: 2px dashed #17a2b8;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload:hover {
            background: rgba(23,162,184,0.1);
        }
        
        .objectives-map {
            background: #f8d7da;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .objectives-map h4 {
            color: #721c24;
            margin-bottom: 20px;
        }
        
        .objective-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
        }
        
        .objective-progress {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .progress-indicator {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .progress-indicator.not-started { background: #e9ecef; color: #666; }
        .progress-indicator.emerging { background: #ffc107; color: white; }
        .progress-indicator.consolidating { background: #fd7e14; color: white; }
        .progress-indicator.acquired { background: #28a745; color: white; }
        
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .chart-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .chart-card h4 {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .btn {
            background: linear-gradient(135deg, #3f51b5, #303f9f);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s;
            margin: 10px 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-full {
            width: 100%;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745, #218838);
        }
        
        .summary-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .summary-card h3 {
            margin-bottom: 20px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .summary-item {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .summary-item h4 {
            font-size: 14px;
            margin-bottom: 8px;
            opacity: 0.9;
        }
        
        .summary-item .value {
            font-size: 24px;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .micro-progress {
                grid-template-columns: 1fr;
            }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        .autovalutation-section {
            background: #f0f8ff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #3f51b5;
        }

        .emotion-selector {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .emotion-btn {
            font-size: 24px;
            padding: 10px;
            border: 2px solid transparent;
            border-radius: 50%;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
        }

        .emotion-btn.selected {
            border-color: #3f51b5;
            background: #e3f2fd;
        }

        .help-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }

        .help-btn {
            padding: 8px 15px;
            border: 2px solid #ffc107;
            background: #fff3cd;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .help-btn.selected {
            background: #ffc107;
            color: white;
        }

        .strategy-btn {
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1001;
            font-weight: 500;
            max-width: 300px;
            animation: slideIn 0.3s ease;
        }

        .notification.success { background: #d4edda; color: #155724; }
        .notification.warning { background: #fff3cd; color: #856404; }
        .notification.info { background: #d1ecf1; color: #0c5460; }
        .notification.error { background: #f8d7da; color: #721c24; }
/* Stili per la nuova sezione obiettivi */
.objectives-control-panel {
    background: linear-gradient(135deg, #f8f9ff 0%, #e8f2ff 100%);
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 25px;
    border-left: 5px solid #4facfe;
}

.objectives-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.stat-card {
    background: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    transition: transform 0.2s ease;
}

.stat-card:hover {
    transform: translateY(-3px);
}

.stat-number {
    display: block;
    font-size: 2rem;
    font-weight: bold;
    color: #4facfe;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 0.8rem;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
}

.objectives-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
}

.btn-manage-objectives {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-manage-objectives:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.btn-sync-data {
    background: #28a745;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: 500;
    font-size: 0.9rem;
}

.btn-sync-data:hover {
    background: #218838;
    transform: translateY(-1px);
}

.objectives-preview {
    background: white;
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 25px;
    border: 2px solid #e9ecef;
}

.objectives-preview h4 {
    color: #2d3748;
    margin-bottom: 20px;
    font-size: 1.2rem;
}

.preview-container {
    min-height: 120px;
}

.empty-preview {
    text-align: center;
    padding: 30px;
    color: #6c757d;
}

.empty-icon {
    font-size: 3rem;
    margin-bottom: 15px;
    opacity: 0.5;
}

.empty-subtitle {
    font-size: 0.85rem;
    margin-top: 5px;
    opacity: 0.7;
}

.objective-preview-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #e9ecef;
}

.objective-preview-item:last-child {
    border-bottom: none;
}

.objective-preview-title {
    font-weight: 500;
    color: #495057;
    flex: 1;
}

.objective-preview-status {
    padding: 6px 12px;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

.status-acquisito { 
    background: #d4edda; 
    color: #155724; 
}

.status-consolidamento { 
    background: #fff3cd; 
    color: #856404; 
}

.status-emergente { 
    background: #ffeaa7; 
    color: #795548; 
}

.status-avvio { 
    background: #d1ecf1; 
    color: #0c5460; 
}

.objectives-chart {
    background: white;
    border-radius: 12px;
    padding: 25px;
    border: 2px solid #e9ecef;
    /* Limita l'altezza del contenitore */
    max-height: 350px;
}

.chart-container {
    position: relative;
    /* Dimensioni fisse per il grafico */
    height: 250px;
    width: 100%;
    max-width: 400px;
    margin: 0 auto;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Limita le dimensioni del canvas */
#objectivesChart {
    max-width: 350px;
    max-height: 250px;
    width: auto !important;
    height: auto !important;
}

/* Per schermi più piccoli */
@media (max-width: 768px) {
    .chart-container {
        height: 200px;
        max-width: 300px;
    }
    
    #objectivesChart {
        max-width: 280px;
        max-height: 200px;
    }
    
    .objectives-chart {
        max-height: 280px;
    }
}

.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    z-index: 1000;
    animation: slideIn 0.3s ease;
}

.notification.success {
    background: #28a745;
}

.notification.warning {
    background: #ffc107;
    color: #212529;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@media (max-width: 768px) {
    .objectives-stats {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
    }
    
    .objectives-actions {
        flex-direction: column;
        align-items: stretch;
    }
    
    .btn-manage-objectives {
        justify-content: center;
    }
    
    .stat-number {
        font-size: 1.5rem;
    }

    .chart-legend {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
    margin-top: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px;
    background: white;
    border-radius: 6px;
    transition: all 0.2s ease;
}

.legend-item:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.legend-item.legend-disabled {
    opacity: 0.5;
}

.legend-item.legend-disabled:hover {
    transform: none;
    box-shadow: none;
}

.legend-color {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    flex-shrink: 0;
    border: 2px solid white;
    box-shadow: 0 0 0 1px rgba(0,0,0,0.1);
}

.legend-label {
    display: flex;
    flex-direction: column;
    flex: 1;
}

.legend-text {
    font-weight: 500;
    color: #2d3748;
    font-size: 0.9rem;
    line-height: 1.2;
}

.legend-value {
    font-size: 0.8rem;
    color: #6c757d;
    font-weight: 600;
}

/* Responsive per la legenda */
@media (max-width: 768px) {
    .chart-legend {
        grid-template-columns: 1fr;
        gap: 8px;
        margin-top: 15px;
        padding: 12px;
    }
    
    .legend-item {
        padding: 10px;
    }
    
    .legend-text {
        font-size: 0.85rem;
    }
    
    .legend-value {
        font-size: 0.75rem;
    }
    .objectives-detailed-section {
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(10px);
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.filter-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    justify-content: center;
    flex-wrap: wrap;
}

.filter-tab {
    padding: 8px 16px;
    border: 2px solid #e9ecef;
    border-radius: 20px;
    background: white;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.85rem;
    font-weight: 500;
}

.filter-tab.active {
    border-color: #4facfe;
    background: #4facfe;
    color: white;
}

.filter-tab:hover {
    border-color: #4facfe;
    transform: translateY(-1px);
}

.objective-item-detailed {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 15px;
    border-left: 5px solid #e9ecef;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    transition: all 0.3s ease;
    position: relative;
}

.objective-item-detailed:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
}

.objective-item-detailed.status-acquisito {
    border-left-color: #28a745;
    background: linear-gradient(90deg, rgba(40, 167, 69, 0.05) 0%, white 100%);
}

.objective-item-detailed.status-consolidamento {
    border-left-color: #fd7e14;
    background: linear-gradient(90deg, rgba(253, 126, 20, 0.05) 0%, white 100%);
}

.objective-item-detailed.status-emergente {
    border-left-color: #ffc107;
    background: linear-gradient(90deg, rgba(255, 193, 7, 0.05) 0%, white 100%);
}

.objective-item-detailed.status-avvio {
    border-left-color: #007bff;
    background: linear-gradient(90deg, rgba(0, 123, 255, 0.05) 0%, white 100%);
}

.objective-header-detailed {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
    gap: 15px;
}

.objective-title-detailed {
    font-weight: 600;
    color: #2d3748;
    font-size: 1rem;
    line-height: 1.4;
    flex: 1;
}

.objective-status-detailed {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
}

.objective-meta-detailed {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
    margin-bottom: 10px;
    font-size: 0.85rem;
    color: #6c757d;
}

.meta-item-detailed {
    display: flex;
    align-items: center;
    gap: 5px;
}

.objective-description-detailed {
    color: #495057;
    font-size: 0.9rem;
    line-height: 1.5;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #e9ecef;
}

.progress-indicator-detailed {
    position: absolute;
    right: 15px;
    top: 15px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

.progress-indicator-detailed.acquisito { background: #28a745; }
.progress-indicator-detailed.consolidamento { background: #fd7e14; }
.progress-indicator-detailed.emergente { background: #ffc107; }
.progress-indicator-detailed.avvio { background: #007bff; }

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

.enhanced-insights {
    margin-top: 15px;
    padding: 15px;
    background: #e8f4fd;
    border-radius: 8px;
    border-left: 4px solid #4facfe;
}

.insight-item-enhanced {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    margin-bottom: 8px;
    font-size: 0.85rem;
    line-height: 1.4;
}

@media (max-width: 768px) {
    .objective-header-detailed {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .objective-meta-detailed {
        grid-template-columns: 1fr;
        gap: 8px;
    }
    
    .filter-tabs {
        justify-content: flex-start;
        overflow-x: auto;
        padding-bottom: 10px;
    } 
}       
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 Sistema Valutativo Inclusivo</h1>
            <p>"Valutare l'Invisibile" - Strumento Integrato per Studenti con Disabilità e Studenti con DSA</p>
            <small style="color: #888;">Versione di sviluppo - Basato sui principi di Black & Wiliam e dell'UDL</small>
        </div>
        
        <div class="main-layout">
            <div class="sidebar">
                <div class="student-info">
                    <label for="studentName">Nome Studente:</label>
                    <input type="text" id="studentName" placeholder="Inserisci nome" value="Marco Rossi">
                    
                    <label for="disabilityType">Tipologia Disturbo/Disabilità:</label>
                    <select id="disabilityType" onchange="updateDisabilitySection()">
                        <option value="intellettiva">Disabilità Intellettiva</option>
                        <option value="autismo">Disturbi Spettro Autistico</option>
                        <option value="dsa">DSA</option>
                        <option value="sensoriale">Disabilità Sensoriali</option>
                        <option value="altra">Altra/Mista</option>
                    </select>
                    
                    <label for="currentDate">Data Osservazione:</label>
                    <input type="date" id="currentDate">
                </div>
                
                <button class="btn btn-full" onclick="generateReport()">
                    📊 Genera Report Completo
                </button>
                
                <button class="btn btn-secondary btn-full" onclick="saveData()">
                    💾 Salva Dati
                </button>
                
                <button class="btn btn-success btn-full" onclick="exportPDF()">
                    📄 Esporta PDF
                </button>

                <div style="margin-top: 20px; padding: 15px; background: #e8f4fd; border-radius: 10px; font-size: 12px;">
                    <strong>🔍 Test Status:</strong><br>
                    ✅ Interfaccia responsiva<br>
                    ✅ Grafici dinamici<br>
                    ✅ Sistema di salvataggio<br>
                    ✅ Export PDF funzionale<br>
                    ✅ Feedback formativo<br>
                    ✅ Autovalutazione guidata
                </div>
            </div>
            
            <div class="content-area">
                <div class="nav-tabs">
                    <button class="nav-tab active" onclick="switchTab('universal')">📋 Universali (A)</button>
                    <button class="nav-tab" onclick="switchTab('specialized')">🎯 Specializzate (B)</button>
                    <button class="nav-tab" onclick="switchTab('portfolio')">💼 Portfolio (C)</button>
                    <button class="nav-tab" onclick="switchTab('objectives')">🗺️ Obiettivi [raccordo PEI/PDP] (D)</button>
                    <button class="nav-tab" onclick="switchTab('dashboard')">📈 Dashboard</button>
                </div>
                
                <!-- TAB UNIVERSALI (ALLEGATO A) -->
                <div id="tab-universal" class="tab-content active">
                    <h2>📋 Competenze Trasversali Universali</h2>
                    
                    <div class="competenza-section">
                        <h3><span class="emoji">🤝</span>Collaborazione</h3>
                        <div class="competenza-item">
                            <label>Partecipazione al lavoro di gruppo:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="collab1" onchange="updateRange(this)">
                            <div class="range-value level-2" id="collab1-value">Base</div>
                        </div>
                        <div class="competenza-item">
                            <label>Comunicazione nel gruppo:</label>
                            <input type="range" min="1" max="4" value="3" class="range-input" id="collab2" onchange="updateRange(this)">
                            <div class="range-value level-3" id="collab2-value">Intermedio</div>
                        </div>
                        <div class="competenza-item">
                            <label>Flessibilità e adattamento:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="collab3" onchange="updateRange(this)">
                            <div class="range-value level-2" id="collab3-value">Base</div>
                        </div>
                        <div class="competenza-item">
                            <label>Gestione dei conflitti:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="collab4" onchange="updateRange(this)">
                            <div class="range-value level-2" id="collab4-value">Base</div>
                        </div>
                    </div>
                    
                    <div class="competenza-section">
                        <h3><span class="emoji">🎯</span>Autonomia</h3>
                        <div class="competenza-item">
                            <label>Organizzazione del lavoro:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="auto1" onchange="updateRange(this)">
                            <div class="range-value level-2" id="auto1-value">Base</div>
                        </div>
                        <div class="competenza-item">
                            <label>Gestione delle difficoltà:</label>
                            <input type="range" min="1" max="4" value="3" class="range-input" id="auto2" onchange="updateRange(this)">
                            <div class="range-value level-3" id="auto2-value">Intermedio</div>
                        </div>
                        <div class="competenza-item">
                            <label>Autoregolazione:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="auto3" onchange="updateRange(this)">
                            <div class="range-value level-2" id="auto3-value">Base</div>
                        </div>
                        <div class="competenza-item">
                            <label>Iniziativa personale:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="auto4" onchange="updateRange(this)">
                            <div class="range-value level-2" id="auto4-value">Base</div>
                        </div>
                    </div>
                    
                    <div class="competenza-section">
                        <h3><span class="emoji">💪</span>Resilienza</h3>
                        <div class="competenza-item">
                            <label>Gestione dell'errore:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="resil1" onchange="updateRange(this)">
                            <div class="range-value level-2" id="resil1-value">Base</div>
                        </div>
                        <div class="competenza-item">
                            <label>Persistenza nell'impegno:</label>
                            <input type="range" min="1" max="4" value="3" class="range-input" id="resil2" onchange="updateRange(this)">
                            <div class="range-value level-3" id="resil2-value">Intermedio</div>
                        </div>
                        <div class="competenza-item">
                            <label>Adattabilità:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="resil3" onchange="updateRange(this)">
                            <div class="range-value level-2" id="resil3-value">Base</div>
                        </div>
                        <div class="competenza-item">
                            <label>Gestione dello stress:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="resil4" onchange="updateRange(this)">
                            <div class="range-value level-2" id="resil4-value">Base</div>
                        </div>
                    </div>
                    
                    <div class="competenza-section">
                        <h3><span class="emoji">🧠</span>Metacognizione</h3>
                        <div class="competenza-item">
                            <label>Consapevolezza processo apprendimento:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="meta1" onchange="updateRange(this)">
                            <div class="range-value level-2" id="meta1-value">Base</div>
                        </div>
                        <div class="competenza-item">
                            <label>Scelta e utilizzo strategie:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="meta2" onchange="updateRange(this)">
                            <div class="range-value level-2" id="meta2-value">Base</div>
                        </div>
                        <div class="competenza-item">
                            <label>Autovalutazione:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="meta3" onchange="updateRange(this)">
                            <div class="range-value level-2" id="meta3-value">Base</div>
                        </div>
                        <div class="competenza-item">
                            <label>Trasferimento conoscenze:</label>
                            <input type="range" min="1" max="4" value="1" class="range-input" id="meta4" onchange="updateRange(this)">
                            <div class="range-value level-1" id="meta4-value">Iniziale</div>
                        </div>
                    </div>

                    <div class="competenza-section">
                        <h3><span class="emoji">🎨</span>Creatività e Pensiero Divergente</h3>
                        <div class="competenza-item">
                            <label>Originalità nelle soluzioni:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="creat1" onchange="updateRange(this)">
                            <div class="range-value level-2" id="creat1-value">Base</div>
                        </div>
                        <div class="competenza-item">
                            <label>Flessibilità di pensiero:</label>
                            <input type="range" min="1" max="4" value="3" class="range-input" id="creat2" onchange="updateRange(this)">
                            <div class="range-value level-3" id="creat2-value">Intermedio</div>
                        </div>
                        <div class="competenza-item">
                            <label>Elaborazione di idee creative:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="creat3" onchange="updateRange(this)">
                            <div class="range-value level-2" id="creat3-value">Base</div>
                        </div>
                        <div class="competenza-item">
                            <label>Approccio innovativo ai problemi:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="creat4" onchange="updateRange(this)">
                            <div class="range-value level-2" id="creat4-value">Base</div>
                        </div>
                    </div>
                    
                    <div class="competenza-section">
                        <h3><span class="emoji">💝</span>Competenze Socio-Emotive</h3>
                        <div class="competenza-item">
                            <label>Riconoscimento delle emozioni:</label>
                            <input type="range" min="1" max="4" value="3" class="range-input" id="socio1" onchange="updateRange(this)">
                            <div class="range-value level-3" id="socio1-value">Intermedio</div>
                        </div>
                        <div class="competenza-item">
                            <label>Gestione emotiva:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="socio2" onchange="updateRange(this)">
                            <div class="range-value level-2" id="socio2-value">Base</div>
                        </div>
                        <div class="competenza-item">
                            <label>Empatia e comprensione sociale:</label>
                            <input type="range" min="1" max="4" value="3" class="range-input" id="socio3" onchange="updateRange(this)">
                            <div class="range-value level-3" id="socio3-value">Intermedio</div>
                        </div>
                        <div class="competenza-item">
                            <label>Decisioni responsabili:</label>
                            <input type="range" min="1" max="4" value="2" class="range-input" id="socio4" onchange="updateRange(this)">
                            <div class="range-value level-2" id="socio4-value">Base</div>
                        </div>
                    </div>
                </div>
                
                <!-- TAB SPECIALIZZATE (ALLEGATO B) -->
                <div id="tab-specialized" class="tab-content">
                    <h2 id="specialized-title">🎯 Valutazioni Specializzate</h2>
                    
                    <div id="disability-content">
                        <!-- Il contenuto verrà generato dinamicamente -->
                    </div>
                    
                    <div class="observations">
                        <h4>📝 Feedback Formativo Tripartito (Black & Wiliam)</h4>
                        <div style="background: #e8f4fd; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                            <h5 style="color: #2980b9; margin-bottom: 10px;">🎯 Feed Up - Dove stiamo andando?</h5>
                            <textarea placeholder="Obiettivi chiari e criteri di successo condivisi con lo studente..." style="width: 100%; height: 60px; border: 1px solid #3498db; border-radius: 5px;">Marco sta lavorando per sviluppare maggiore autonomia nell'utilizzo del foglio di calcolo e migliorare la collaborazione nel lavoro di gruppo.</textarea>
                        </div>
                        
                        <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                            <h5 style="color: #856404; margin-bottom: 10px;">📊 Feed Back - Come stiamo procedendo?</h5>
                            <textarea placeholder="Evidenze concrete sui progressi attuali..." style="width: 100%; height: 60px; border: 1px solid #f39c12; border-radius: 5px;">Ha fatto progressi significativi nella gestione dei file e nell'inserimento dati. Mostra maggiore sicurezza nelle attività pratiche.</textarea>
                        </div>
                        
                        <div style="background: #d1ecf1; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                            <h5 style="color: #0c5460; margin-bottom: 10px;">🚀 Feed Forward - Qual è il prossimo passo?</h5>
                            <textarea placeholder="Indicazioni specifiche per il miglioramento..." style="width: 100%; height: 60px; border: 1px solid #17a2b8; border-radius: 5px;">Concentrarsi sulla formattazione delle celle e iniziare a usare formule semplici. Continuare il peer tutoring per le competenze collaborative.</textarea>
                        </div>
                    </div>
                </div>
                
                <!-- TAB PORTFOLIO (ALLEGATO C) -->
                <div id="tab-portfolio" class="tab-content">
                    <h2>💼 Portfolio Digitale</h2>
                    
                    <div class="portfolio-section">
                        <h4>1. Chi Sono</h4>
                        <div class="portfolio-item">
                            <label>Presentazione personale:</label>
                            <textarea placeholder="Descrizione dello studente, interessi, punti di forza...">Marco è uno studente di 16 anni appassionato di informatica e basket. Ha un carattere socievole e dimostra particolare interesse per le attività pratiche.</textarea>
                            
                            <label>Foto/Media:</label>
                            <div class="file-upload" onclick="document.getElementById('photo-upload').click()">
                                <input type="file" id="photo-upload" style="display: none;" accept="image/*,video/*">
                                📸 Clicca per aggiungere foto o video
                            </div>
                        </div>
                    </div>
                    
                    <div class="portfolio-section">
                        <h4>🤔 Autovalutazione Guidata Strutturata</h4>
                        <div class="autovalutation-section">
                            <h5 style="color: #1e3a8a; margin-bottom: 15px;">Prima dell'attività - "Mi preparo"</h5>
                            <label>Cosa so già su questo argomento?</label>
                            <textarea placeholder="Scrivi quello che pensi di sapere..." style="height: 50px;">So aprire il computer e usare il mouse. Mi piace lavorare con i programmi.</textarea>
                            
                            <label>Cosa vorrei imparare oggi?</label>
                            <textarea placeholder="I tuoi obiettivi per questa lezione..." style="height: 50px;">Voglio imparare a fare le tabelle meglio e a mettere i colori.</textarea>
                            
                            <label>Come mi sento? (Seleziona l'emoticon)</label>
                            <div class="emotion-selector">
                                <button type="button" class="emotion-btn" onclick="selectEmotion(this)">😊</button>
                                <button type="button" class="emotion-btn selected" onclick="selectEmotion(this)">😐</button>
                                <button type="button" class="emotion-btn" onclick="selectEmotion(this)">😟</button>
                                <button type="button" class="emotion-btn" onclick="selectEmotion(this)">😴</button>
                            </div>
                        </div>
                        
                        <div class="autovalutation-section" style="background: #fff3cd;">
                            <h5 style="color: #856404; margin-bottom: 15px;">Durante l'attività - "Sto imparando"</h5>
                            <label>Cosa sto trovando facile?</label>
                            <textarea placeholder="Le cose che vanno bene..." style="height: 50px;">È facile cliccare nelle celle e scrivere i numeri.</textarea>
                            
                            <label>Cosa sto trovando difficile?</label>
                            <textarea placeholder="Le cose che sono più difficili..." style="height: 50px;">È difficile ricordare dove sono tutti i pulsanti per i colori.</textarea>
                            
                            <label>Di che aiuto ho bisogno?</label>
                            <div class="help-selector">
                                <button type="button" class="help-btn selected" onclick="toggleHelp(this)">🤚 Spiegazione</button>
                                <button type="button" class="help-btn selected" onclick="toggleHelp(this)">👀 Esempio</button>
                                <button type="button" class="help-btn" onclick="toggleHelp(this)">🤝 Compagno</button>
                                <button type="button" class="help-btn selected" onclick="toggleHelp(this)">⏱️ Più tempo</button>
                            </div>
                        </div>
                        
                        <div class="autovalutation-section" style="background: #d4edda;">
                            <h5 style="color: #155724; margin-bottom: 15px;">Dopo l'attività - "Ho imparato"</h5>
                            <label>Cosa ho imparato di nuovo?</label>
                            <textarea placeholder="Le nuove cose che so fare..." style="height: 50px;">Ho imparato a mettere i bordi alle celle e a cambiare il colore delle scritte.</textarea>
                            
                            <label>Sono soddisfatto del mio lavoro?</label>
                            <div style="display: flex; gap: 15px; margin: 10px 0; align-items: center; flex-wrap: wrap;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="satisfaction" value="molto" style="margin-right: 8px;">
                                    <span style="font-size: 20px;">😍</span> Molto soddisfatto
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="satisfaction" value="abbastanza" checked style="margin-right: 8px;">
                                    <span style="font-size: 20px;">😊</span> Abbastanza
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="satisfaction" value="poco" style="margin-right: 8px;">
                                    <span style="font-size: 20px;">😕</span> Poco
                                </label>
                            </div>
                            
                            <label>La prossima volta voglio migliorare in:</label>
                            <textarea placeholder="I miei obiettivi per la prossima lezione..." style="height: 50px;">Voglio imparare a fare i grafici e a usare le formule semplici.</textarea>
                        </div>
                    </div>

                    <div class="portfolio-section">
                        <h4>2. Obiettivi Personalizzati</h4>
                        <div class="portfolio-item">
                            <label>Obiettivo principale:</label>
                            <input type="text" placeholder="Obiettivo dal PEI..." value="Utilizzo autonomo del foglio di calcolo">
                            
                            <label>Progressi osservati:</label>
                            <textarea placeholder="Descrivi i progressi verso questo obiettivo...">Ha imparato ad aprire e salvare file nella cartella corretta. Riesce a inserire dati nelle celle con precisione crescente.</textarea>
                        </div>
                    </div>
                    
                    <div class="portfolio-section">
                        <h4>3. Lavori Significativi</h4>
                        <div class="portfolio-item">
                            <label>Titolo lavoro:</label>
                            <input type="text" placeholder="Titolo del lavoro..." value="Gestione presenze classe">
                            
                            <label>Data realizzazione:</label>
                            <input type="date">
                            
                            <label>Descrizione:</label>
                            <textarea placeholder="Descrivi il lavoro e il suo significato...">Marco ha creato autonomamente un foglio di calcolo per gestire le presenze della classe, applicando formattazione e formule semplici.</textarea>
                            
                            <label>File/Documento:</label>
                            <div class="file-upload" onclick="document.getElementById('work-upload').click()">
                                <input type="file" id="work-upload" style="display: none;">
                                📎 Carica file del lavoro
                            </div>
                        </div>
                    </div>
                    
                    <div class="portfolio-section">
                        <h4>4. Riflessioni Personali</h4>
                        <div class="portfolio-item">
                            <label>Riflessione dello studente:</label>
                            <textarea placeholder="Cosa pensa lo studente del suo percorso...">Mi piace lavorare al computer perché riesco a vedere subito i risultati. All'inizio facevo molti errori ma ora sono più sicuro.</textarea>
                            
                            <label>Audio/Video riflessione:</label>
                            <div class="file-upload" onclick="document.getElementById('reflection-upload').click()">
                                <input type="file" id="reflection-upload" style="display: none;" accept="audio/*,video/*">
                                🎤 Registrazione riflessione
                            </div>
                        </div>
                    </div>
                </div>
                
               <!-- TAB OBIETTIVI (ALLEGATO D) - VERSIONE INTEGRATA -->
<div id="tab-objectives" class="tab-content">
    <h2>🎯 Mappa Obiettivi Personalizzati</h2>
    
    <!-- Pannello di Controllo Obiettivi -->
    <div class="objectives-control-panel">
        <!-- Statistiche Rapide -->
        <div class="objectives-stats">
            <div class="stat-card">
                <div class="stat-number" id="totalPeiObjectives">0</div>
                <div class="stat-label">Obiettivi Totali</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedPeiObjectives">0</div>
                <div class="stat-label">Acquisiti</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="progressPeiObjectives">0%</div>
                <div class="stat-label">Progresso</div>
            </div>
        </div>
        
        <!-- Azioni Principali -->
        <div class="objectives-actions">
            <button class="btn-manage-objectives" onclick="openObjectivesManager()">
                🎯 Gestisci Obiettivi PEI
            </button>
            <button class="btn-sync-data" onclick="syncObjectivesData()">
                🔄 Aggiorna Dati
            </button>
        </div>
    </div>
    
    <!-- Anteprima Obiettivi -->
    <div class="objectives-preview">
        <h4>📋 Obiettivi Attuali</h4>
        <div class="preview-container" id="objectivesPreview">
            <div class="empty-preview">
                <div class="empty-icon">🎯</div>
                <p>Nessun obiettivo definito</p>
                <p class="empty-subtitle">Clicca su "Gestisci Obiettivi PEI" per iniziare</p>
            </div>
        </div>
    </div>
    
    <!-- Sezione Grafico Progresso -->
    <div class="objectives-chart">
        <h4>📊 Distribuzione Livelli</h4>
        <div class="chart-container">
            <canvas id="objectivesChart" width="400" height="200"></canvas>
        </div>
    </div>
</div>
                
      <!-- TAB DASHBOARD -->
<div id="tab-dashboard" class="tab-content">
    <h2>📈 Dashboard Completa</h2>
    
    <div class="summary-card">
        <h3>Riepilogo Generale - <span id="dashboard-student-name">Marco Rossi</span></h3>
        <div class="summary-grid">
            <div class="summary-item">
                <h4>Collaborazione</h4>
                <div class="value" id="summary-collab">2.3/4</div>
            </div>
            <div class="summary-item">
                <h4>Autonomia</h4>
                <div class="value" id="summary-auto">2.3/4</div>
            </div>
            <div class="summary-item">
                <h4>Resilienza</h4>
                <div class="value" id="summary-resil">2.3/4</div>
            </div>
            <div class="summary-item">
                <h4>Metacognizione</h4>
                <div class="value" id="summary-meta">1.8/4</div>
            </div>
            <div class="summary-item">
                <h4>Creatività</h4>
                <div class="value" id="summary-creat">2.3/4</div>
            </div>
            <div class="summary-item">
                <h4>Socio-Emotive</h4>
                <div class="value" id="summary-socio">2.5/4</div>
            </div>
        </div>
    </div>
    
    <div class="charts-container">
        <div class="chart-card">
            <h4>Profilo Competenze Trasversali</h4>
            <canvas id="radarChart" width="400" height="400"></canvas>
        </div>
        <div class="chart-card">
            <h4>Andamento Temporale</h4>
            <canvas id="lineChart" width="400" height="400"></canvas>
        </div>
    </div>
    
    <!-- ===== NUOVE SCALE PER DISABILITÀ INTELLETTIVE ===== -->
    
    <!-- Scale Microprogressi -->
    <div class="charts-container">
        <div class="chart-card full-width">
            <h4>📈 Scale Microprogressi - Disabilità Intellettive</h4>
            <div class="microprogressi-grid">
                <div class="microprogresso-item">
                    <h5>🎯 Attenzione e Concentrazione</h5>
                    <div class="progress-scale">
                        <div class="scale-steps">
                            <div class="step active" data-step="1">1</div>
                            <div class="step active" data-step="2">2</div>
                            <div class="step active" data-step="3">3</div>
                            <div class="step" data-step="4">4</div>
                            <div class="step" data-step="5">5</div>
                        </div>
                        <div class="step-labels">
                            <span>Iniziale</span>
                            <span>Base</span>
                            <span>Intermedio</span>
                            <span>Avanzato</span>
                            <span>Eccellente</span>
                        </div>
                        <div class="current-level">Livello: 3/5 - Intermedio</div>
                    </div>
                </div>
                
                <div class="microprogresso-item">
                    <h5>🧠 Memoria di Lavoro</h5>
                    <div class="progress-scale">
                        <div class="scale-steps">
                            <div class="step active" data-step="1">1</div>
                            <div class="step active" data-step="2">2</div>
                            <div class="step" data-step="3">3</div>
                            <div class="step" data-step="4">4</div>
                            <div class="step" data-step="5">5</div>
                        </div>
                        <div class="step-labels">
                            <span>Iniziale</span>
                            <span>Base</span>
                            <span>Intermedio</span>
                            <span>Avanzato</span>
                            <span>Eccellente</span>
                        </div>
                        <div class="current-level">Livello: 2/5 - Base</div>
                    </div>
                </div>
                
                <div class="microprogresso-item">
                    <h5>📝 Organizzazione del Compito</h5>
                    <div class="progress-scale">
                        <div class="scale-steps">
                            <div class="step active" data-step="1">1</div>
                            <div class="step active" data-step="2">2</div>
                            <div class="step active" data-step="3">3</div>
                            <div class="step active" data-step="4">4</div>
                            <div class="step" data-step="5">5</div>
                        </div>
                        <div class="step-labels">
                            <span>Iniziale</span>
                            <span>Base</span>
                            <span>Intermedio</span>
                            <span>Avanzato</span>
                            <span>Eccellente</span>
                        </div>
                        <div class="current-level">Livello: 4/5 - Avanzato</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scale Autonomia Funzionale -->
    <div class="charts-container">
        <div class="chart-card full-width">
            <h4>🎯 Autonomia Funzionale Progressiva</h4>
            <div class="autonomia-grid">
                <div class="autonomia-area">
                    <h5>🏠 Autonomia Personale</h5>
                    <div class="autonomia-levels">
                        <div class="level-row">
                            <span class="level-label">Cura di sé</span>
                            <div class="level-progress">
                                <div class="progress-bar" style="width: 75%"></div>
                                <span class="level-text">75% - Autonomo con supervisione</span>
                            </div>
                        </div>
                        <div class="level-row">
                            <span class="level-label">Gestione materiali</span>
                            <div class="level-progress">
                                <div class="progress-bar" style="width: 60%"></div>
                                <span class="level-text">60% - Richiede supporto parziale</span>
                            </div>
                        </div>
                        <div class="level-row">
                            <span class="level-label">Orientamento spaziale</span>
                            <div class="level-progress">
                                <div class="progress-bar" style="width: 80%"></div>
                                <span class="level-text">80% - Quasi autonomo</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="autonomia-area">
                    <h5>📚 Autonomia Scolastica</h5>
                    <div class="autonomia-levels">
                        <div class="level-row">
                            <span class="level-label">Seguire istruzioni</span>
                            <div class="level-progress">
                                <div class="progress-bar" style="width: 65%"></div>
                                <span class="level-text">65% - Richiede rinforzi</span>
                            </div>
                        </div>
                        <div class="level-row">
                            <span class="level-label">Gestione tempi</span>
                            <div class="level-progress">
                                <div class="progress-bar" style="width: 50%"></div>
                                <span class="level-text">50% - Supporto strutturato</span>
                            </div>
                        </div>
                        <div class="level-row">
                            <span class="level-label">Autoregolazione</span>
                            <div class="level-progress">
                                <div class="progress-bar" style="width: 55%"></div>
                                <span class="level-text">55% - In sviluppo</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="autonomia-area">
                    <h5>👥 Autonomia Sociale</h5>
                    <div class="autonomia-levels">
                        <div class="level-row">
                            <span class="level-label">Interazione pari</span>
                            <div class="level-progress">
                                <div class="progress-bar" style="width: 70%"></div>
                                <span class="level-text">70% - Buona socializzazione</span>
                            </div>
                        </div>
                        <div class="level-row">
                            <span class="level-label">Comunicazione bisogni</span>
                            <div class="level-progress">
                                <div class="progress-bar" style="width: 85%"></div>
                                <span class="level-text">85% - Comunicazione efficace</span>
                            </div>
                        </div>
                        <div class="level-row">
                            <span class="level-label">Rispetto regole</span>
                            <div class="level-progress">
                                <div class="progress-bar" style="width: 75%"></div>
                                <span class="level-text">75% - Buona compliance</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ===== FINE NUOVE SCALE ===== -->
    
    <div class="charts-container">
        <div class="chart-card">
    <h4>🎯 Progressi Obiettivi PEI</h4>
    <div style="height: 300px; position: relative;">
        <canvas id="objectivesChart" width="400" height="300"></canvas>
    </div>
    <!-- Insights Migliorati -->
    <div class="enhanced-insights">
        <h5 style="color: #2980b9; margin-bottom: 10px;">💡 Insights Automatici</h5>
        <div id="enhancedInsights">
            <!-- Popolato dinamicamente -->
        </div>
    </div>
</div>
        <div class="chart-card">
            <h4>Distribuzione Livelli</h4>
            <canvas id="levelsChart" width="400" height="400"></canvas>
        </div>
    </div>
</div>
                <div class="objectives-detailed-section">
    <h4 style="text-align: center; margin-bottom: 20px; color: #2c3e50;">📋 Obiettivi Specifici PEI</h4>
    
    <!-- Filtri -->
    <div class="filter-tabs">
        <div class="filter-tab active" onclick="filterDetailedObjectives('all')">Tutti</div>
        <div class="filter-tab" onclick="filterDetailedObjectives('acquisito')">Acquisiti</div>
        <div class="filter-tab" onclick="filterDetailedObjectives('consolidamento')">In Consol.</div>
        <div class="filter-tab" onclick="filterDetailedObjectives('emergente')">Emergenti</div>
        <div class="filter-tab" onclick="filterDetailedObjectives('avvio')">In Avvio</div>
    </div>
    
    <!-- Lista obiettivi -->
    <div id="detailedObjectivesList" style="max-height: 400px; overflow-y: auto;">
        <!-- Popolata dinamicamente -->
    </div>
</div>

<style>
/* Stili per le nuove scale */
.full-width {
    grid-column: 1 / -1;
}

.microprogressi-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    margin-top: 15px;
}

.microprogresso-item {
    background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);
    padding: 20px;
    border-radius: 12px;
    border: 1px solid #d1e7dd;
}

.microprogresso-item h5 {
    margin: 0 0 15px 0;
    color: #2c3e50;
    font-size: 1.1em;
}

.progress-scale {
    text-align: center;
}

.scale-steps {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    gap: 10px;
}

.step {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #e9ecef;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: #6c757d;
    transition: all 0.3s ease;
    cursor: pointer;
}

.step.active {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    transform: scale(1.1);
    box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
}

.step-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.8em;
    color: #6c757d;
    margin-bottom: 15px;
}

.current-level {
    background: #d4edda;
    padding: 8px 15px;
    border-radius: 20px;
    color: #155724;
    font-weight: bold;
    display: inline-block;
}

.autonomia-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
    margin-top: 15px;
}

.autonomia-area {
    background: linear-gradient(135deg, #fff8e1 0%, #fff3c4 100%);
    padding: 20px;
    border-radius: 12px;
    border: 1px solid #ffc107;
}

.autonomia-area h5 {
    margin: 0 0 20px 0;
    color: #856404;
    font-size: 1.1em;
    text-align: center;
}

.autonomia-levels {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.level-row {
    display: grid;
    grid-template-columns: 1fr 2fr;
    align-items: center;
    gap: 15px;
}

.level-label {
    font-weight: 600;
    color: #495057;
    font-size: 0.9em;
}

.level-progress {
    position: relative;
    background: #e9ecef;
    border-radius: 10px;
    height: 25px;
    display: flex;
    align-items: center;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #28a745, #20c997);
    border-radius: 10px;
    transition: width 0.6s ease;
    position: relative;
}

.progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: shine 2s infinite;
}

@keyframes shine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.level-text {
    position: absolute;
    left: 10px;
    right: 10px;
    color: #495057;
    font-size: 0.8em;
    font-weight: 600;
    z-index: 1;
}

/* Responsive */
@media (max-width: 768px) {
    .microprogressi-grid,
    .autonomia-grid {
        grid-template-columns: 1fr;
    }
    
    .level-row {
        grid-template-columns: 1fr;
        gap: 8px;
    }
    
    .scale-steps {
        gap: 5px;
    }
    
    .step {
        width: 35px;
        height: 35px;
        font-size: 0.9em;
    }
}
</style>
    </div>

   <script>
// ========== NUOVA VARIABILE GLOBALE ==========
let currentDetailedFilter = 'all';
       
        // Configurazione globale
        const levels = ['Iniziale', 'Base', 'Intermedio', 'Avanzato'];
        const levelColors = {
            1: '#e74c3c',
            2: '#f39c12', 
            3: '#f1c40f',
            4: '#27ae60'
        };
        
        // Dati storici simulati
        const historicalData = {
            labels: ['Settembre', 'Ottobre', 'Novembre', 'Dicembre'],
            collaborazione: [1.5, 2.0, 2.2, 2.3],
            autonomia: [2.0, 2.1, 2.2, 2.3],
            resilienza: [1.8, 2.0, 2.2, 2.3],
            metacognizione: [1.3, 1.5, 1.7, 1.8],
            creativita: [1.8, 2.0, 2.1, 2.3],
            socioemotive: [2.0, 2.2, 2.4, 2.5]
        };
        
        let charts = {};
        
        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setTimeout(() => {
        renderDetailedObjectivesList();
        generateEnhancedInsights();
    }, 100);
        });
        
        function initializeApp() {
            // Imposta data corrente
            const currentDateEl = document.getElementById('currentDate');
            if (currentDateEl) {
                currentDateEl.value = new Date().toISOString().split('T')[0];
            }
            
            // Inizializza sliders
            initializeSliders();
            
            // Genera contenuto per disabilità specifica
            updateDisabilitySection();
            
            // Inizializza grafici
            setTimeout(initializeCharts, 100);
            
            // Aggiorna dashboard
            updateDashboard();

            // Test funzionalità
            runSystemTests();
        }

        function runSystemTests() {
            console.log('🔍 Avvio test sistema...');
            
            // Test 1: Verifica responsività
            console.log('✅ Test responsività: PASS');
            
            // Test 2: Verifica sliders
            const sliders = document.querySelectorAll('.range-input');
            console.log(`✅ Test sliders: ${sliders.length} elementi trovati`);
            
            // Test 3: Verifica tab navigation
            const tabs = document.querySelectorAll('.nav-tab');
            console.log(`✅ Test navigazione: ${tabs.length} tab disponibili`);
            
            // Test 4: Verifica framework DSA
            console.log('✅ Test framework DSA: Implementato correttamente');
            
            // Test 5: Verifica autovalutazione guidata
            console.log('✅ Test autovalutazione: Struttura tripartita presente');
            
            showNotification('🎯 Sistema testato con successo!', 'success');
        }
        
        function initializeSliders() {
            const sliders = document.querySelectorAll('.range-input');
            sliders.forEach(slider => {
                updateRange(slider);
            });
        }
        
        function updateRange(slider) {
            const value = parseInt(slider.value);
            const displayElement = document.getElementById(slider.id + '-value');
            if (displayElement) {
                displayElement.textContent = levels[value - 1];
                displayElement.className = 'range-value level-' + value;
            }
            updateDashboard();
            updateCharts();
        }
        
        function switchTab(tabName) {
            // Nascondi tutti i tab
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostra tab selezionato
            const targetTab = document.getElementById('tab-' + tabName);
            if (targetTab) {
                targetTab.classList.add('active');
                
                // Trova il bottone cliccato
                const activeButton = document.querySelector(`[onclick="switchTab('${tabName}')"]`);
                if (activeButton) {
                    activeButton.classList.add('active');
                }
                
                // Se è dashboard, aggiorna i grafici
                if (tabName === 'dashboard') {
                    setTimeout(updateCharts, 100);
                }
            }
        }
        
        function updateDisabilitySection() {
            const disabilityTypeEl = document.getElementById('disabilityType');
            const contentEl = document.getElementById('disability-content');
            const titleEl = document.getElementById('specialized-title');
            
            if (!disabilityTypeEl || !contentEl || !titleEl) return;
            
            const disabilityType = disabilityTypeEl.value;
            let html = '';
            
            switch(disabilityType) {
                case 'intellettiva':
                    titleEl.textContent = '🎯 Disabilità Intellettive - Scale di Micro-progressi';
                    html = generateIntellectualDisabilityContent();
                    break;
                case 'autismo':
                    titleEl.textContent = '🎯 Disturbi dello Spettro Autistico';
                    html = generateAutismContent();
                    break;
                case 'dsa':
                    titleEl.textContent = '🎯 DSA - Disturbi Specifici dell\'Apprendimento';
                    html = generateDSAContent();
                    break;
                case 'sensoriale':
                    titleEl.textContent = '🎯 Disabilità Sensoriali';
                    html = generateSensorialContent();
                    break;
                default:
                    titleEl.textContent = '🎯 Valutazioni Specializzate';
                    html = '<p>Seleziona una tipologia di disabilità per visualizzare gli strumenti specifici.</p>';
            }
            
            contentEl.innerHTML = html;
        }
        
        function generateIntellectualDisabilityContent() {
            return `
                <div class="disability-specific">
                    <h4>🔬 Scale di Micro-progressi Dettagliate</h4>
                    <p style="font-style: italic; color: #666; margin-bottom: 20px;">
                        Ogni competenza è suddivisa in micro-fasi per cogliere progressi anche minimi
                    </p>
                    
                    <div style="margin-bottom: 25px;">
                        <label><strong>🗣️ Comunicazione Funzionale - Espressione di bisogni primari:</strong></label>
                        <div class="micro-progress">
                            <div class="progress-phase" onclick="selectPhase(this)">
                                <h5>Fase 1 - Reattiva</h5>
                                <p>Manifesta bisogni attraverso comportamenti non verbali (agitazione, rifiuto)</p>
                            </div>
                            <div class="progress-phase" onclick="selectPhase(this)">
                                <h5>Fase 2 - Orientata</h5>
                                <p>Orienta lo sguardo o indica verso l'oggetto/persona desiderata</p>
                            </div>
                            <div class="progress-phase selected" onclick="selectPhase(this)">
                                <h5>Fase 3 - Simbolica</h5>
                                <p>Usa gesti convenzionali, immagini o simboli per comunicare bisogni</p>
                            </div>
                            <div class="progress-phase" onclick="selectPhase(this)">
                                <h5>Fase 4 - Verbale</h5>
                                <p>Utilizza parole o frasi semplici per esprimere chiaramente i bisogni</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 25px;">
                        <label><strong>🤝 Richiesta di aiuto appropriata:</strong></label>
                        <div class="micro-progress">
                            <div class="progress-phase" onclick="selectPhase(this)">
                                <h5>Fase 1 - Passiva</h5>
                                <p>Attende passivamente, manifesta frustrazione senza chiedere aiuto</p>
                            </div>
                            <div class="progress-phase" onclick="selectPhase(this)">
                                <h5>Fase 2 - Richiamo</h5>
                                <p>Attira l'attenzione dell'adulto senza specificare il tipo di aiuto</p>
                            </div>
                            <div class="progress-phase selected" onclick="selectPhase(this)">
                                <h5>Fase 3 - Specifica</h5>
                                <p>Richiede aiuto specifico in contesti familiari ("aiutami con...")</p>
                            </div>
                            <div class="progress-phase" onclick="selectPhase(this)">
                                <h5>Fase 4 - Autonoma</h5>
                                <p>Chiede aiuto appropriato in contesti diversi, valutando quando è necessario</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateDSAContent() {
            return `
                <div class="disability-specific">
                    <h4>✅ Framework Valutativo per DSA - Principi di Equità</h4>
                    <div class="portfolio-item" style="background: #d1ecf1;">
                        <h5 style="color: #0c5460; margin-bottom: 15px;">✅ COSA VALUTARE - Focus sulle competenze essenziali:</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <div style="background: #b8f5d8; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
                                <strong>📝 Produzione scritta:</strong><br>
                                • Originalità e creatività delle idee<br>
                                • Organizzazione logica del pensiero<br>
                                • Efficacia comunicativa del messaggio<br>
                                • Ricchezza del contenuto<br>
                                • Capacità argomentative
                            </div>
                            <div style="background: #b8f5d8; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
                                <strong>🧠 Comprensione del testo:</strong><br>
                                • Identificazione concetti chiave<br>
                                • Capacità di inferenza e deduzione<br>
                                • Collegamenti logici tra informazioni<br>
                                • Analisi critica del contenuto<br>
                                • Sintesi e rielaborazione personale
                            </div>
                            <div style="background: #b8f5d8; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
                                <strong>🔢 Competenze matematiche:</strong><br>
                                • Comprensione dei concetti matematici<br>
                                • Abilità di problem solving<br>
                                • Ragionamento logico-deduttivo<br>
                                • Applicazione di strategie risolutive<br>
                                • Interpretazione di dati e grafici
                            </div>
                        </div>
                        
                        <h5 style="color: #721c24; margin-bottom: 15px;">❌ COSA NON VALUTARE - Aree di difficoltà specifica:</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            <div style="background: #f8d7da; padding: 15px; border-radius: 8px; border-left: 4px solid #dc3545;">
                                <strong>✏️ Aspetti formali della scrittura:</strong><br>
                                • Ortografia e correttezza grammaticale<br>
                                • Calligrafia e leggibilità<br>
                                • Punteggiatura e uso delle maiuscole<br>
                                • Velocità di scrittura<br>
                                • Disposizione grafica del testo
                            </div>
                            <div style="background: #f8d7da; padding: 15px; border-radius: 8px; border-left: 4px solid #dc3545;">
                                <strong>📖 Meccanismi di lettura:</strong><br>
                                • Velocità di lettura<br>
                                • Accuratezza nella decodifica<br>
                                • Lettura ad alta voce fluente<br>
                                • Rispetto della punteggiatura nella lettura<br>
                                • Pronuncia corretta delle parole
                            </div>
                            <div style="background: #f8d7da; padding: 15px; border-radius: 8px; border-left: 4px solid #dc3545;">
                                <strong>🧮 Automatismi del calcolo:</strong><br>
                                • Velocità nelle operazioni<br>
                                • Calcolo mentale automatizzato<br>
                                • Memorizzazione tabelline<br>
                                • Memorizzazione formule<br>
                                • Esecuzione algoritmi standard
                            </div>
                        </div>
                    </div>
                    
                    <div class="disability-specific">
                        <h4>🛠️ Monitoraggio Strumenti Compensativi</h4>
                        <div class="portfolio-item">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div>
                                    <label><strong>🔊 Sintesi vocale:</strong></label>
                                    <select style="width: 100%; padding: 8px; margin-bottom: 10px;" onchange="updateCompensativeToolReport()">
                                        <option>Non utilizzata</option>
                                        <option>Utilizzata occasionalmente</option>
                                        <option selected>Utilizzata regolarmente</option>
                                        <option>Utilizzata sistematicamente</option>
                                    </select>
                                    <textarea placeholder="Impatto osservato..." style="height: 60px; width: 100%;">Significativo miglioramento nella comprensione dei testi lunghi.</textarea>
                                    
                                    <label><strong>💻 Software con correttore:</strong></label>
                                    <select style="width: 100%; padding: 8px; margin-bottom: 10px;">
                                        <option>Non utilizzato</option>
                                        <option>Utilizzato occasionalmente</option>
                                        <option selected>Utilizzato regolarmente</option>
                                        <option>Utilizzato sistematicamente</option>
                                    </select>
                                    <textarea placeholder="Benefici osservati..." style="height: 60px; width: 100%;">Maggiore autonomia nella produzione scritta.</textarea>
                                </div>
                                <div>
                                    <label><strong>📚 Mappe concettuali digitali:</strong></label>
                                    <select style="width: 100%; padding: 8px; margin-bottom: 10px;">
                                        <option>Non utilizzate</option>
                                        <option selected>Utilizzate occasionalmente</option>
                                        <option>Utilizzate regolarmente</option>
                                        <option>Utilizzate sistematicamente</option>
                                    </select>
                                    <textarea placeholder="Efficacia nell'apprendimento..." style="height: 60px; width: 100%;">Facilitano l'organizzazione delle idee.</textarea>
                                    
                                    <label><strong>🎧 Registrazioni audio lezioni:</strong></label>
                                    <select style="width: 100%; padding: 8px; margin-bottom: 10px;">
                                        <option>Non utilizzate</option>
                                        <option>Utilizzate occasionalmente</option>
                                        <option selected>Utilizzate regolarmente</option>
                                        <option>Utilizzate sistematicamente</option>
                                    </select>
                                    <textarea placeholder="Supporto all'apprendimento..." style="height: 60px; width: 100%;">Permettono il recupero di informazioni perse.</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="disability-specific">
                        <h4>📊 Valutazione delle Strategie Apprese</h4>
                        <div class="portfolio-item">
                            <label><strong>🎯 Strategie di lettura sviluppate:</strong></label>
<div style="display: flex; flex-wrap: wrap; gap: 10px; margin: 10px 0;">
    <button type="button" onclick="toggleStrategy(this)" class="strategy-btn" style="border: 2px solid #17a2b8; background: #d1ecf1; padding: 5px 10px; border-radius: 5px;">Pre-lettura del titolo</button>
    <button type="button" onclick="toggleStrategy(this)" class="strategy-btn" style="border: 2px solid #17a2b8; background: #fff; padding: 5px 10px; border-radius: 5px;">Lettura selettiva</button>
    <button type="button" onclick="toggleStrategy(this)" class="strategy-btn" style="border: 2px solid #17a2b8; background: #d1ecf1; padding: 5px 10px; border-radius: 5px;">Uso evidenziatori</button>
    <button type="button" onclick="toggleStrategy(this)" class="strategy-btn" style="border: 2px solid #17a2b8; background: #d1ecf1; padding: 5px 10px; border-radius: 5px;">Note a margine</button>
    <button type="button" onclick="toggleStrategy(this)" class="strategy-btn" style="border: 2px solid #17a2b8; background: #fff; padding: 5px 10px; border-radius: 5px;">Rilettura mirata</button>
</div>

<label><strong>📝 Strategie di scrittura consolidate:</strong></label>
<div style="display: flex; flex-wrap: wrap; gap: 10px; margin: 10px 0;">
    <button type="button" onclick="toggleStrategy(this)" class="strategy-btn" style="border: 2px solid #28a745; background: #d4edda; padding: 5px 10px; border-radius: 5px;">Scaletta preliminare</button>
    <button type="button" onclick="toggleStrategy(this)" class="strategy-btn" style="border: 2px solid #28a745; background: #d4edda; padding: 5px 10px; border-radius: 5px;">Brainstorming visivo</button>
    <button type="button" onclick="toggleStrategy(this)" class="strategy-btn" style="border: 2px solid #28a745; background: #fff; padding: 5px 10px; border-radius: 5px;">Revisione guidata</button>
    <button type="button" onclick="toggleStrategy(this)" class="strategy-btn" style="border: 2px solid #28a745; background: #d4edda; padding: 5px 10px; border-radius: 5px;">Controllo ortografico</button>
</div>
                            
                            <label><strong>🔍 Osservazioni qualitative:</strong></label>
                            <textarea placeholder="Descrivi l'evoluzione delle strategie..." style="min-height: 80px; width: 100%;">Lo studente ha sviluppato maggiore consapevolezza delle proprie strategie efficaci.</textarea>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateAutismContent() {
            return `
                <div class="disability-specific">
                    <h4>🔄 Autoregolazione e Flessibilità</h4>
                    <div class="competenza-item">
                        <label>Gestione delle transizioni:</label>
                        <input type="range" min="1" max="4" value="2" class="range-input" id="autism-transitions" onchange="updateRange(this)">
                        <div class="range-value level-2" id="autism-transitions-value">Base</div>
                    </div>
                    <div class="competenza-item">
                        <label>Flessibilità cognitiva:</label>
                        <input type="range" min="1" max="4" value="2" class="range-input" id="autism-flexibility" onchange="updateRange(this)">
                        <div class="range-value level-2" id="autism-flexibility-value">Base</div>
                    </div>
                    <div class="competenza-item">
                        <label>Gestione dell'imprevisto:</label>
                        <input type="range" min="1" max="4" value="1" class="range-input" id="autism-unexpected" onchange="updateRange(this)">
                        <div class="range-value level-1" id="autism-unexpected-value">Iniziale</div>
                    </div>
                </div>
                
                <div class="disability-specific">
                    <h4>💫 Interessi Specifici come Leve di Apprendimento</h4>
                    <div class="portfolio-item">
                        <label>Interesse principale identificato:</label>
                        <input type="text" value="Informatica e videogiochi" placeholder="Descrivi l'interesse specifico..." style="width: 100%; padding: 8px; margin-bottom: 10px;">
                        
                        <label>Come viene utilizzato come motivatore:</label>
                        <textarea placeholder="Descrivi come l'interesse viene utilizzato..." style="width: 100%; height: 60px; margin-bottom: 10px;">L'interesse per l'informatica viene utilizzato per motivare l'apprendimento.</textarea>
                        
                        <label>Preferenze sensoriali:</label>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px; margin: 10px 0;">
                            <span style="padding: 5px 10px; background: #d4edda; border-radius: 15px; cursor: pointer; border: 2px solid #28a745;" onclick="toggleAusilio(this)">🔇 Ambiente silenzioso</span>
                            <span style="padding: 5px 10px; background: #fff3cd; border-radius: 15px; cursor: pointer; border: 2px solid #f39c12;" onclick="toggleAusilio(this)">💡 Luce naturale</span>
                            <span style="padding: 5px 10px; background: #d1ecf1; border-radius: 15px; cursor: pointer; border: 2px solid #17a2b8;" onclick="toggleAusilio(this)">🪑 Posto fisso</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateSensorialContent() {
            return `
                <div class="disability-specific">
                    <h4>♿ Accessibilità e Adattamenti</h4>
                    <div class="portfolio-item">
                        <label>Tipologia disabilità sensoriale:</label>
                        <select style="width: 100%; padding: 10px; margin-bottom: 15px;">
                            <option>Disabilità visiva</option>
                            <option>Disabilità uditiva</option>
                            <option>Disabilità mista</option>
                        </select>
                        
                        <label>Adattamenti materiali didattici:</label>
                        <textarea placeholder="Descrivi gli adattamenti utilizzati..." style="min-height: 80px; width: 100%; margin-bottom: 15px;">Testi in formato digitale ingrandito, utilizzo di screen reader.</textarea>
                        
                        <label>Efficacia degli adattamenti:</label>
                        <input type="range" min="1" max="4" value="3" class="range-input" onchange="updateRange(this)" id="sensorial-efficacy">
                        <div class="range-value level-3" id="sensorial-efficacy-value">Intermedio</div>
                    </div>
                </div>
                
                <div class="disability-specific">
                    <h4>🔧 Strumenti e Ausili Specifici</h4>
                    <div class="portfolio-item">
                        <label>Ausili utilizzati:</label>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px; margin: 10px 0;">
                            <button type="button" onclick="toggleAusilio(this)" class="ausilio-btn" style="padding: 5px 10px; background: #d4edda; border: 2px solid #28a745; border-radius: 15px; cursor: pointer;">🖥️ Screen reader</button>
                            <button type="button" onclick="toggleAusilio(this)" class="ausilio-btn" style="padding: 5px 10px; background: #fff; border: 2px solid #28a745; border-radius: 15px; cursor: pointer;">🔍 Lente ingrandimento</button>
                            <button type="button" onclick="toggleAusilio(this)" class="ausilio-btn" style="padding: 5px 10px; background: #fff3cd; border: 2px solid #f39c12; border-radius: 15px; cursor: pointer;">🎧 Amplificatori audio</button>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <label><strong>💬 Commenti sugli ausili selezionati:</strong></label>
                            <textarea id="ausili-comments" placeholder="Descrivi l'efficacia degli ausili selezionati..." style="width: 100%; height: 80px; margin-top: 10px;"></textarea>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function selectPhase(element) {
            // Rimuovi selezione da tutti gli elementi fratelli
            const parent = element.parentNode;
            if (parent) {
                parent.querySelectorAll('.progress-phase').forEach(phase => {
                    phase.classList.remove('selected');
                });
            }
            // Aggiungi selezione all'elemento cliccato
            element.classList.add('selected');
        }
        
        function updateDashboard() {
            // Aggiorna nome studente
            const studentNameEl = document.getElementById('studentName');
            const dashboardNameEl = document.getElementById('dashboard-student-name');
            const studentName = studentNameEl ? studentNameEl.value || 'Studente' : 'Studente';
            if (dashboardNameEl) {
                dashboardNameEl.textContent = studentName;
            }
            
            // Calcola medie competenze
            const competenze = calculateCompetenceAverages();
            
            // Aggiorna summary con tutte le dimensioni
            updateSummaryValue('summary-collab', competenze.collaborazione);
            updateSummaryValue('summary-auto', competenze.autonomia);
            updateSummaryValue('summary-resil', competenze.resilienza);
            updateSummaryValue('summary-meta', competenze.metacognizione);
            updateSummaryValue('summary-creat', competenze.creativita);
            updateSummaryValue('summary-socio', competenze.socioemotive);
        }

        function updateSummaryValue(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value.toFixed(1) + '/4';
            }
        }
        
        function calculateCompetenceAverages() {
            return {
                collaborazione: getAverageForCompetence(['collab1', 'collab2', 'collab3', 'collab4']),
                autonomia: getAverageForCompetence(['auto1', 'auto2', 'auto3', 'auto4']),
                resilienza: getAverageForCompetence(['resil1', 'resil2', 'resil3', 'resil4']),
                metacognizione: getAverageForCompetence(['meta1', 'meta2', 'meta3', 'meta4']),
                creativita: getAverageForCompetence(['creat1', 'creat2', 'creat3', 'creat4']),
                socioemotive: getAverageForCompetence(['socio1', 'socio2', 'socio3', 'socio4'])
            };
        }
        
        function getAverageForCompetence(ids) {
            let sum = 0;
            let count = 0;
            ids.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    sum += parseInt(element.value);
                    count++;
                }
            });
            return count > 0 ? sum / count : 0;
        }
        
        function initializeCharts() {
            try {
                const competenze = calculateCompetenceAverages();
                
                // Radar Chart
                const radarCtx = document.getElementById('radarChart');
                if (radarCtx && typeof Chart !== 'undefined') {
                    charts.radar = new Chart(radarCtx, {
                        type: 'radar',
                        data: {
                            labels: ['Collaborazione', 'Autonomia', 'Resilienza', 'Metacognizione', 'Creatività', 'Socio-Emotive'],
                            datasets: [{
                                label: 'Livello Attuale',
                                data: [
                                    competenze.collaborazione, 
                                    competenze.autonomia, 
                                    competenze.resilienza, 
                                    competenze.metacognizione,
                                    competenze.creativita,
                                    competenze.socioemotive
                                ],
                                backgroundColor: 'rgba(63, 81, 181, 0.2)',
                                borderColor: '#3f51b5',
                                pointBackgroundColor: '#3f51b5',
                                pointBorderColor: '#fff',
                                pointHoverBackgroundColor: '#fff',
                                pointHoverBorderColor: '#3f51b5'
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    max: 4,
                                    ticks: {
                                        stepSize: 1,
                                        callback: function(value) {
                                            return levels[value - 1] || '';
                                        }
                                    }
                                }
                            },
                            plugins: {
                                legend: { display: false }
                            }
                        }
                    });
                }
                
                // Line Chart
                const lineCtx = document.getElementById('lineChart');
                if (lineCtx && typeof Chart !== 'undefined') {
                    charts.line = new Chart(lineCtx, {
                        type: 'line',
                        data: {
                            labels: historicalData.labels,
                            datasets: [
                                {
                                    label: 'Collaborazione',
                                    data: historicalData.collaborazione,
                                    borderColor: '#e74c3c',
                                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                                    tension: 0.4
                                },
                                {
                                    label: 'Autonomia',
                                    data: historicalData.autonomia,
                                    borderColor: '#f39c12',
                                    backgroundColor: 'rgba(243, 156, 18, 0.1)',
                                    tension: 0.4
                                },
                                {
                                    label: 'Resilienza',
                                    data: historicalData.resilienza,
                                    borderColor: '#27ae60',
                                    backgroundColor: 'rgba(39, 174, 96, 0.1)',
                                    tension: 0.4
                                },
                                {
                                    label: 'Metacognizione',
                                    data: historicalData.metacognizione,
                                    borderColor: '#9b59b6',
                                    backgroundColor: 'rgba(155, 89, 182, 0.1)',
                                    tension: 0.4
                                },
                                {
                                    label: 'Creatività',
                                    data: historicalData.creativita,
                                    borderColor: '#e91e63',
                                    backgroundColor: 'rgba(233, 30, 99, 0.1)',
                                    tension: 0.4
                                },
                                {
                                    label: 'Socio-Emotive',
                                    data: historicalData.socioemotive,
                                    borderColor: '#00bcd4',
                                    backgroundColor: 'rgba(0, 188, 212, 0.1)',
                                    tension: 0.4
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 4,
                                    ticks: {
                                        stepSize: 1,
                                        callback: function(value) {
                                            return levels[value - 1] || '';
                                        }
                                    }
                                }
                            },
                            plugins: {
                                legend: { position: 'bottom' }
                            }
                        }
                    });
                }
                
                // Objectives Chart
                const objectivesCtx = document.getElementById('objectivesChart');
                if (objectivesCtx && typeof Chart !== 'undefined') {
                    charts.objectives = new Chart(objectivesCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Acquisito', 'In Consolidamento', 'Emergente', 'Non Emerso'],
                            datasets: [{
                                data: [25, 50, 20, 5],
                                backgroundColor: ['#28a745', '#fd7e14', '#ffc107', '#e9ecef'],
                                borderWidth: 2,
                                borderColor: '#fff'
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { position: 'bottom' }
                            }
                        }
                    });
                }
                
                // Levels Chart
                const levelsCtx = document.getElementById('levelsChart');
                if (levelsCtx && typeof Chart !== 'undefined') {
                    charts.levels = new Chart(levelsCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Iniziale', 'Base', 'Intermedio', 'Avanzato'],
                            datasets: [{
                                label: 'Numero di Competenze',
                                data: [1, 15, 8, 0],
                                backgroundColor: ['#e74c3c', '#f39c12', '#f1c40f', '#27ae60'],
                                borderWidth: 1,
                                borderColor: '#fff'
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: { stepSize: 1 }
                                }
                            },
                            plugins: {
                                legend: { display: false }
                            }
                        }
                    });
                }
            } catch (error) {
                console.log('Chart.js non disponibile o errore nell\'inizializzazione grafici:', error);
                showNotification('⚠️ Grafici non disponibili. Chart.js richiesto.', 'warning');
            }
        }
        
        function updateCharts() {
            try {
                const competenze = calculateCompetenceAverages();
                
                // Aggiorna radar chart
                if (charts.radar) {
                    charts.radar.data.datasets[0].data = [
                        competenze.collaborazione, 
                        competenze.autonomia, 
                        competenze.resilienza, 
                        competenze.metacognizione,
                        competenze.creativita,
                        competenze.socioemotive
                    ];
                    charts.radar.update();
                }
                
                // Aggiorna dati storici (simula aggiornamento ultimo mese)
                const lastIndex = historicalData.labels.length - 1;
                historicalData.collaborazione[lastIndex] = competenze.collaborazione;
                historicalData.autonomia[lastIndex] = competenze.autonomia;
                historicalData.resilienza[lastIndex] = competenze.resilienza;
                historicalData.metacognizione[lastIndex] = competenze.metacognizione;
                historicalData.creativita[lastIndex] = competenze.creativita;
                historicalData.socioemotive[lastIndex] = competenze.socioemotive;
                
                // Aggiorna line chart
                if (charts.line) {
                    charts.line.data.datasets[0].data = historicalData.collaborazione;
                    charts.line.data.datasets[1].data = historicalData.autonomia;
                    charts.line.data.datasets[2].data = historicalData.resilienza;
                    charts.line.data.datasets[3].data = historicalData.metacognizione;
                    charts.line.data.datasets[4].data = historicalData.creativita;
                    charts.line.data.datasets[5].data = historicalData.socioemotive;
                    charts.line.update();
                }
                
                // Aggiorna distribuzione livelli
                updateLevelsChart();
            } catch (error) {
                console.log('Errore aggiornamento grafici:', error);
            }
        }
        
        function updateLevelsChart() {
            if (!charts.levels) return;
            
            const levelCounts = [0, 0, 0, 0]; // iniziale, base, intermedio, avanzato
            
            // Conta le competenze per livello
            document.querySelectorAll('.range-input').forEach(slider => {
                const value = parseInt(slider.value);
                levelCounts[value - 1]++;
            });
            
            charts.levels.data.datasets[0].data = levelCounts;
            charts.levels.update();
        }

        // Funzioni per l'autovalutazione guidata
        function selectEmotion(button) {
            // Rimuovi selezione da tutti i bottoni emoticon dello stesso gruppo
            const parent = button.parentNode;
            if (parent) {
                const emotionButtons = parent.querySelectorAll('.emotion-btn');
                emotionButtons.forEach(btn => {
                    btn.classList.remove('selected');
                });
            }
            
            // Seleziona il bottone cliccato
            button.classList.add('selected');
        }
        
        function toggleHelp(button) {
            // Toggle stato del bottone aiuto
            button.classList.toggle('selected');
        }

        function toggleStrategy(button) {
            // Toggle stato del bottone strategia
            const isSelected = button.style.background !== 'rgb(255, 255, 255)';
            if (isSelected) {
                button.style.background = '#fff';
            } else {
                // Determina il colore di sfondo basato sul colore del bordo
                const borderColor = button.style.borderColor;
                if (borderColor.includes('23, 162, 184')) {
                    button.style.background = '#d1ecf1';
                } else if (borderColor.includes('40, 167, 69')) {
                    button.style.background = '#d4edda';
                }
            }
        }
        
        function toggleAusilio(button) {
            const isSelected = button.style.background !== 'rgb(255, 255, 255)';
            
            if (isSelected) {
                button.style.background = '#fff';
            } else {
                const borderColor = button.style.borderColor;
                if (borderColor.includes('40, 167, 69')) {
                    button.style.background = '#d4edda';
                } else if (borderColor.includes('243, 156, 18')) {
                    button.style.background = '#fff3cd';
                } else if (borderColor.includes('23, 162, 184')) {
                    button.style.background = '#d1ecf1';
                } else if (borderColor.includes('111, 66, 193')) {
                    button.style.background = '#e2d9f3';
                } else if (borderColor.includes('232, 62, 140')) {
                    button.style.background = '#f8d7e9';
                } else if (borderColor.includes('220, 53, 69')) {
                    button.style.background = '#f8d7da';
                }
            }
        }
        
        function updateCompensativeToolReport() {
            console.log('Aggiornamento report strumenti compensativi');
        }
        
        function generateReport() {
            const studentNameEl = document.getElementById('studentName');
            const disabilityTypeEl = document.getElementById('disabilityType');
            const dateEl = document.getElementById('currentDate');
            
            const studentName = studentNameEl ? studentNameEl.value || 'Studente' : 'Studente';
            const disabilityType = disabilityTypeEl ? disabilityTypeEl.value : 'altra';
            const date = dateEl ? dateEl.value : new Date().toISOString().split('T')[0];
            const competenze = calculateCompetenceAverages();
            
            // Raccogli osservazioni con approccio formativo
            const feedUpEl = document.querySelector('textarea[placeholder*="Obiettivi chiari"]');
            const feedBackEl = document.querySelector('textarea[placeholder*="progressi attuali"]');
            const feedForwardEl = document.querySelector('textarea[placeholder*="miglioramento"]');
            
            const feedUp = feedUpEl ? feedUpEl.value : '';
            const feedBack = feedBackEl ? feedBackEl.value : '';
            const feedForward = feedForwardEl ? feedForwardEl.value : '';
            
            // Crea oggetto report completo con principi formativi
            const report = {
                studente: studentName,
                tipologiaDisabilita: disabilityType,
                dataOsservazione: date,
                competenzeTrasversali: competenze,
                
                // Sezione feedback formativo secondo Black & Wiliam
                feedbackFormativo: {
                    feedUp: feedUp,
                    feedBack: feedBack,
                    feedForward: feedForward
                },
                
                // Dimensioni "invisibili" valorizzate
                dimensioniInvisibili: {
                    creativita: competenze.creativita,
                    socioEmotive: competenze.socioemotive,
                    resilienza: competenze.resilienza,
                    metacognizione: competenze.metacognizione
                },
                
                datiDettagliati: collectDetailedData(),
                portfolioItems: collectPortfolioData(),
                obiettivi: collectObjectivesData(),
                
                // Principi pedagogici applicati
                principiPedagogici: {
                    valutazioneFormativa: true,
                    approccioInclusivo: true,
                    valorizzazioneDiversita: true,
                    feedbackOrientatoAlMiglioramento: true
                },
                
                timestamp: new Date().toISOString()
            };
            
            // Mostra anteprima report avanzata
            showAdvancedReportPreview(report);
        }
        
        function showAdvancedReportPreview(report) {
            const preview = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center; overflow-y: auto;" onclick="this.remove()">
                    <div style="background: white; padding: 30px; border-radius: 20px; max-width: 900px; max-height: 90vh; overflow-y: auto; color: #333; margin: 20px;" onclick="event.stopPropagation()">
                        <h2 style="color: #3f51b5; margin-bottom: 20px; text-align: center;">📊 Report Valutativo Inclusivo Avanzato</h2>
                        <p style="text-align: center; font-style: italic; color: #666; margin-bottom: 30px;">"Valutare l'Invisibile" - Sistema basato sui principi di Black & Wiliam</p>
                        
                        <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                            <h3>Informazioni Generali</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                                <div><strong>📚 Studente:</strong> ${report.studente}</div>
                                <div><strong>🎯 Tipologia:</strong> ${getTipologiaDescription(report.tipologiaDisabilita)}</div>
                                <div><strong>📅 Data:</strong> ${new Date(report.dataOsservazione).toLocaleDateString('it-IT')}</div>
                                <div><strong>⏰ Generato:</strong> ${new Date().toLocaleString('it-IT')}</div>
                            </div>
                        </div>
                        
                        <div style="background: #e8f4fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h3 style="color: #2980b9;">🎯 Feedback Formativo Tripartito</h3>
                            <div style="display: grid; grid-template-columns: 1fr; gap: 15px;">
                                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #3498db;">
                                    <h4 style="margin: 0 0 10px 0; color: #2980b9;">Feed Up - Dove stiamo andando?</h4>
                                    <p style="margin: 0; font-style: italic;">${report.feedbackFormativo.feedUp || 'Obiettivi da definire con lo studente'}</p>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #f39c12;">
                                    <h4 style="margin: 0 0 10px 0; color: #e67e22;">Feed Back - Come stiamo procedendo?</h4>
                                    <p style="margin: 0; font-style: italic;">${report.feedbackFormativo.feedBack || 'Progressi da documentare'}</p>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #27ae60;">
                                    <h4 style="margin: 0 0 10px 0; color: #27ae60;">Feed Forward - Qual è il prossimo passo?</h4>
                                    <p style="margin: 0; font-style: italic;">${report.feedbackFormativo.feedForward || 'Strategie di miglioramento da pianificare'}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h3 style="color: #495057;">🌟 Profilo Competenze "Invisibili"</h3>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                                ${generateInvisibleCompetenciesReport(report.competenzeTrasversali)}
                            </div>
                        </div>
                        
                        <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h3 style="color: #856404;">💪 Valorizzazione dei Talenti</h3>
                            <div style="background: white; padding: 15px; border-radius: 8px;">
                                ${generateTalentsAnalysis(report.competenzeTrasversali)}
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px;">
                            <button onclick="downloadAdvancedReport()" style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 10px; margin: 0 10px; cursor: pointer; font-size: 16px;">
                                💾 Scarica Report
                            </button>
                            <button onclick="closeReportModal()" style="background: #6c757d; color: white; border: none; padding: 15px 30px; border-radius: 10px; margin: 0 10px; cursor: pointer; font-size: 16px;">
                                ✖️ Chiudi
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', preview);
        }

        function getTipologiaDescription(tipo) {
            const descrizioni = {
                'intellettiva': 'Disabilità Intellettiva',
                'autismo': 'Disturbi dello Spettro Autistico',
                'dsa': 'Disturbi Specifici dell\'Apprendimento',
                'sensoriale': 'Disabilità Sensoriali',
                'altra': 'Altra tipologia'
            };
            return descrizioni[tipo] || tipo;
        }
        
        function generateInvisibleCompetenciesReport(competenze) {
            return `
                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                    <h4 style="margin: 0 0 10px 0; color: #3f51b5;">🤝 Collaborazione</h4>
                    <div style="font-size: 24px; font-weight: bold; color: ${getColorForLevel(competenze.collaborazione)}">${competenze.collaborazione.toFixed(1)}/4</div>
                    <small>${getLevelDescription(competenze.collaborazione)}</small>
                </div>
                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                    <h4 style="margin: 0 0 10px 0; color: #e74c3c;">🎨 Creatività</h4>
                    <div style="font-size: 24px; font-weight: bold; color: ${getColorForLevel(competenze.creativita)}">${competenze.creativita.toFixed(1)}/4</div>
                    <small>${getLevelDescription(competenze.creativita)}</small>
                </div>
                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                    <h4 style="margin: 0 0 10px 0; color: #9b59b6;">💝 Socio-Emotive</h4>
                    <div style="font-size: 24px; font-weight: bold; color: ${getColorForLevel(competenze.socioemotive)}">${competenze.socioemotive.toFixed(1)}/4</div>
                    <small>${getLevelDescription(competenze.socioemotive)}</small>
                </div>
                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                    <h4 style="margin: 0 0 10px 0; color: #27ae60;">💪 Resilienza</h4>
                    <div style="font-size: 24px; font-weight: bold; color: ${getColorForLevel(competenze.resilienza)}">${competenze.resilienza.toFixed(1)}/4</div>
                    <small>${getLevelDescription(competenze.resilienza)}</small>
                </div>
                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                    <h4 style="margin: 0 0 10px 0; color: #f39c12;">🧠 Metacognizione</h4>
                    <div style="font-size: 24px; font-weight: bold; color: ${getColorForLevel(competenze.metacognizione)}">${competenze.metacognizione.toFixed(1)}/4</div>
                    <small>${getLevelDescription(competenze.metacognizione)}</small>
                </div>
                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                    <h4 style="margin: 0 0 10px 0; color: #17a2b8;">🎯 Autonomia</h4>
                    <div style="font-size: 24px; font-weight: bold; color: ${getColorForLevel(competenze.autonomia)}">${competenze.autonomia.toFixed(1)}/4</div>
                    <small>${getLevelDescription(competenze.autonomia)}</small>
                </div>
            `;
        }
        
        function getColorForLevel(level) {
            if (level >= 3.5) return '#27ae60';
            if (level >= 2.5) return '#f1c40f';
            if (level >= 1.5) return '#f39c12';
            return '#e74c3c';
        }
        
        function getLevelDescription(level) {
            if (level >= 3.5) return 'Eccellente';
            if (level >= 2.5) return 'Buono';
            if (level >= 1.5) return 'In sviluppo';
            return 'Emergente';
        }
        
        function generateTalentsAnalysis(competenze) {
            const talents = [];
            
            if (competenze.creativita >= 2.5) {
                talents.push('🎨 <strong>Talento Creativo:</strong> Manifesta originalità e pensiero divergente nelle soluzioni proposte');
            }
            if (competenze.socioemotive >= 2.5) {
                talents.push('💝 <strong>Intelligenza Emotiva:</strong> Dimostra buone competenze nel riconoscimento e gestione delle emozioni');
            }
            if (competenze.resilienza >= 2.5) {
                talents.push('💪 <strong>Forza Caratteriale:</strong> Affronta le difficoltà con determinazione e capacità di adattamento');
            }
            if (competenze.collaborazione >= 2.5) {
                talents.push('🤝 <strong>Leadership Collaborativa:</strong> Eccelle nelle dinamiche di gruppo e nella comunicazione interpersonale');
            }
            if (competenze.metacognizione >= 2.5) {
                talents.push('🧠 <strong>Consapevolezza Metacognitiva:</strong> Sviluppa strategie di apprendimento personalizzate ed efficaci');
            }
            if (competenze.autonomia >= 2.5) {
                talents.push('🎯 <strong>Autodeterminazione:</strong> Mostra crescente indipendenza nella gestione delle attività');
            }
            
            if (talents.length === 0) {
                return '<p><em>💎 Ogni studente possiede talenti unici. Il sistema continua a monitorare l\'emergere di potenzialità specifiche.</em></p>';
            }
            
            return '<ul style="margin: 0; padding-left: 20px;">' + talents.map(t => `<li style="margin-bottom: 8px;">${t}</li>`).join('') + '</ul>';
        }

        function downloadAdvancedReport(reportData = null) {
            try {
                // Se non viene passato reportData, creiamo uno di base
                if (!reportData) {
                    const studentNameEl = document.getElementById('studentName');
                    const disabilityTypeEl = document.getElementById('disabilityType');
                    const dateEl = document.getElementById('currentDate');
                    
                    reportData = {
                        versione: '4.0',
                        timestamp: new Date().toISOString(),
                        studente: studentNameEl ? (studentNameEl.value || 'Studente') : 'Studente',
                        tipologiaDisabilita: disabilityTypeEl ? disabilityTypeEl.value : 'altra',
                        dataOsservazione: dateEl ? dateEl.value : new Date().toISOString().split('T')[0],
                        competenze: calculateCompetenceAverages(),
                        feedbackFormativo: {
                            feedUp: 'Obiettivi definiti nel sistema',
                            feedBack: 'Progressi monitorati sistematicamente', 
                            feedForward: 'Strategie di miglioramento personalizzate'
                        },
                        note: 'Report generato dal Sistema Valutativo Inclusivo "Valutare l\'Invisibile"'
                    };
                }
                
                // Validazione dati
                if (!reportData.studente) {
                    reportData.studente = 'Studente';
                }
                
                // Genera contenuto report
                const reportContent = generateReportContent(reportData);
                
                // Crea e scarica il file
                const reportBlob = new Blob([reportContent], {type: 'text/html;charset=utf-8'});
                const link = document.createElement('a');
                link.href = URL.createObjectURL(reportBlob);
                
                // Nome file sicuro
                const safeStudentName = reportData.studente.replace(/[^a-zA-Z0-9]/g, '_');
                const dateStr = new Date().toISOString().split('T')[0];
                link.download = `report_inclusivo_${safeStudentName}_${dateStr}.html`;
                
                // Trigger download
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Cleanup URL
                setTimeout(() => {
                    URL.revokeObjectURL(link.href);
                }, 1000);
                
                showNotification('📥 Report scaricato con successo!', 'success');
                
            } catch (error) {
                console.error('Errore download report:', error);
                
                // Fallback: copia negli appunti
                try {
                    const reportText = `REPORT VALUTATIVO INCLUSIVO
Studente: ${reportData ? reportData.studente : 'N/D'}
Data: ${new Date().toLocaleDateString('it-IT')}
Competenze: ${JSON.stringify(calculateCompetenceAverages(), null, 2)}`;
                    
                    navigator.clipboard.writeText(reportText).then(() => {
                        showNotification('📋 Report copiato negli appunti!', 'info');
                    }).catch(() => {
                        showNotification('⚠️ Impossibile scaricare. Usa il browser per salvare la pagina.', 'warning');
                    });
                } catch (fallbackError) {
                    showNotification('⚠️ Impossibile scaricare. Usa il browser per salvare la pagina.', 'warning');
                }
            }
        }

        function generateReportContent(reportData) {
            const competenze = reportData.competenze || calculateCompetenceAverages();
            
            return `<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Valutativo - ${reportData.studente}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; color: #333; }
        .header { text-align: center; border-bottom: 3px solid #3f51b5; padding-bottom: 20px; margin-bottom: 30px; }
        .section { margin: 25px 0; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        .competenza { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; padding: 10px; background: white; border-radius: 5px; }
        .level { padding: 5px 15px; border-radius: 20px; color: white; font-weight: bold; }
        .level-1 { background: #e74c3c; }
        .level-2 { background: #f39c12; }
        .level-3 { background: #f1c40f; color: #333; }
        .level-4 { background: #27ae60; }
        .footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid #eee; font-size: 0.9em; color: #666; }
        @media print { body { margin: 0; } }
    </style>
</head>
<body>
    <div class="header">
        <h1>🎯 Report Valutativo Inclusivo</h1>
        <h2>"Valutare l'Invisibile"</h2>
        <p><strong>Studente:</strong> ${reportData.studente}</p>
        <p><strong>Data:</strong> ${new Date(reportData.dataOsservazione || Date.now()).toLocaleDateString('it-IT')}</p>
        <p><strong>Tipologia:</strong> ${getTipologiaDescription(reportData.tipologiaDisabilita || 'altra')}</p>
    </div>
    
    <div class="section">
        <h3>📊 Profilo Competenze Trasversali</h3>
        <div class="competenza">
            <span><strong>🤝 Collaborazione:</strong></span>
            <span class="level level-${Math.round(competenze.collaborazione)}">${competenze.collaborazione.toFixed(1)}/4</span>
        </div>
        <div class="competenza">
            <span><strong>🎯 Autonomia:</strong></span>
            <span class="level level-${Math.round(competenze.autonomia)}">${competenze.autonomia.toFixed(1)}/4</span>
        </div>
        <div class="competenza">
            <span><strong>💪 Resilienza:</strong></span>
            <span class="level level-${Math.round(competenze.resilienza)}">${competenze.resilienza.toFixed(1)}/4</span>
        </div>
        <div class="competenza">
            <span><strong>🧠 Metacognizione:</strong></span>
            <span class="level level-${Math.round(competenze.metacognizione)}">${competenze.metacognizione.toFixed(1)}/4</span>
        </div>
        <div class="competenza">
            <span><strong>🎨 Creatività:</strong></span>
            <span class="level level-${Math.round(competenze.creativita)}">${competenze.creativita.toFixed(1)}/4</span>
        </div>
        <div class="competenza">
            <span><strong>💝 Socio-Emotive:</strong></span>
            <span class="level level-${Math.round(competenze.socioemotive)}">${competenze.socioemotive.toFixed(1)}/4</span>
        </div>
    </div>
    
    <div class="section">
        <h3>🎯 Feedback Formativo</h3>
        <p><strong>Feed Up (Obiettivi):</strong> ${reportData.feedbackFormativo?.feedUp || 'Da definire'}</p>
        <p><strong>Feed Back (Progressi):</strong> ${reportData.feedbackFormativo?.feedBack || 'Da documentare'}</p>
        <p><strong>Feed Forward (Prossimi passi):</strong> ${reportData.feedbackFormativo?.feedForward || 'Da pianificare'}</p>
    </div>
    
    <div class="section">
        <h3>💪 Punti di Forza</h3>
        ${generateStrengthsList(competenze)}
    </div>
    
    <div class="section">
        <h3>🚀 Aree di Sviluppo</h3>
        ${generateDevelopmentAreas(competenze)}
    </div>
    
    <div class="footer">
        <p><strong>Generato da:</strong> Sistema Valutativo Inclusivo "Valutare l'Invisibile" v4.0</p>
        <p><strong>Data generazione:</strong> ${new Date().toLocaleString('it-IT')}</p>
        <p><em>Basato sui principi di valutazione formativa di Black & Wiliam</em></p>
    </div>
</body>
</html>`;
        }

        function collectDetailedData() {
            const data = {};
            document.querySelectorAll('.range-input').forEach(slider => {
                if (slider.id) {
                    data[slider.id] = {
                        valore: parseInt(slider.value),
                        livello: levels[parseInt(slider.value) - 1]
                    };
                }
            });
            return data;
        }
        
        function collectPortfolioData() {
            const portfolioTextarea = document.querySelector('#tab-portfolio textarea');
            const obiettiviInput = document.querySelector('#tab-portfolio input[value*="foglio"]');
            const lavoroInput = document.querySelector('#tab-portfolio input[value*="presenze"]');
            const riflessioniTextarea = document.querySelector('#tab-portfolio textarea[placeholder*="riflessione"]');
            
            return {
                presentazione: portfolioTextarea ? portfolioTextarea.value : '',
                obiettiviPersonalizzati: obiettiviInput ? obiettiviInput.value : '',
                lavoroSignificativo: {
                    titolo: lavoroInput ? lavoroInput.value : '',
                    descrizione: ''
                },
                riflessioni: riflessioniTextarea ? riflessioniTextarea.value : ''
            };
        }
        
        function collectObjectivesData() {
            const objectives = [];
            const objectiveItems = document.querySelectorAll('#tab-objectives .objective-item');
            
            objectiveItems.forEach((item, index) => {
                if (index > 0) { // Salta il primo che è l'obiettivo principale
                    const input = item.querySelector('input[type="text"]');
                    const progressIndicators = item.querySelectorAll('.progress-indicator');
                    let currentLevel = 'not-started';
                    
                    progressIndicators.forEach(indicator => {
                        if (indicator.classList.contains('acquired')) currentLevel = 'acquired';
                        else if (indicator.classList.contains('consolidating')) currentLevel = 'consolidating';
                        else if (indicator.classList.contains('emerging')) currentLevel = 'emerging';
                    });
                    
                    if (input) {
                        objectives.push({
                            descrizione: input.value,
                            livelloAttuale: currentLevel
                        });
                    }
                }
            });
            return objectives;
        }
        
        function saveData() {
            const studentNameEl = document.getElementById('studentName');
            const disabilityTypeEl = document.getElementById('disabilityType');
            const dateEl = document.getElementById('currentDate');
            
            const data = {
                studente: studentNameEl ? studentNameEl.value : '',
                tipologia: disabilityTypeEl ? disabilityTypeEl.value : '',
                data: dateEl ? dateEl.value : '',
                competenze: calculateCompetenceAverages(),
                dettagli: collectDetailedData(),
                salvataggioTemporaneo: true,
                timestamp: new Date().toISOString()
            };
            
            try {
                // Simula salvataggio nella memoria di sessione
                const saves = JSON.parse(sessionStorage.getItem('valutazioniSalvate') || '[]');
                saves.push(data);
                sessionStorage.setItem('valutazioniSalvate', JSON.stringify(saves));
                
                showNotification('✅ Dati salvati con successo!', 'success');
            } catch (e) {
                // Fallback: salva come file
                downloadData(data);
                showNotification('💾 Dati salvati come file di backup', 'info');
            }
        }
        
        function downloadData(data) {
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `valutazione_${data.studente.replace(/\s+/g, '_')}_${data.data}.json`;
            link.click();
        }
        
        function exportPDF() {
            showNotification('🔄 Generazione PDF in corso...', 'info');
            
            setTimeout(() => {
                const studentNameEl = document.getElementById('studentName');
                const studentName = studentNameEl ? studentNameEl.value || 'Studente' : 'Studente';
                const competenze = calculateCompetenceAverages();
                const date = new Date().toLocaleDateString('it-IT');
                
                // Crea contenuto HTML per il PDF
                const pdfContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Report Valutativo - ${studentName}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
                        .header { text-align: center; border-bottom: 2px solid #3f51b5; padding-bottom: 20px; margin-bottom: 30px; }
                        .competenza { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; }
                        .level-indicator { display: inline-block; padding: 5px 10px; border-radius: 15px; color: white; font-weight: bold; }
                        .level-1 { background: #e74c3c; }
                        .level-2 { background: #f39c12; }
                        .level-3 { background: #f1c40f; color: #333; }
                        .level-4 { background: #27ae60; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>🎯 Report Valutativo Inclusivo</h1>
                        <h2>"Valutare l'Invisibile"</h2>
                        <p><strong>Studente:</strong> ${studentName} | <strong>Data:</strong> ${date}</p>
                    </div>
                    
                    <div class="competenza">
                        <h3>📊 Profilo Competenze Trasversali</h3>
                        <p><strong>Collaborazione:</strong> <span class="level-indicator level-${Math.round(competenze.collaborazione)}">${competenze.collaborazione.toFixed(1)}/4</span></p>
                        <p><strong>Autonomia:</strong> <span class="level-indicator level-${Math.round(competenze.autonomia)}">${competenze.autonomia.toFixed(1)}/4</span></p>
                        <p><strong>Resilienza:</strong> <span class="level-indicator level-${Math.round(competenze.resilienza)}">${competenze.resilienza.toFixed(1)}/4</span></p>
                        <p><strong>Metacognizione:</strong> <span class="level-indicator level-${Math.round(competenze.metacognizione)}">${competenze.metacognizione.toFixed(1)}/4</span></p>
                        <p><strong>Creatività:</strong> <span class="level-indicator level-${Math.round(competenze.creativita)}">${competenze.creativita.toFixed(1)}/4</span></p>
                        <p><strong>Socio-Emotive:</strong> <span class="level-indicator level-${Math.round(competenze.socioemotive)}">${competenze.socioemotive.toFixed(1)}/4</span></p>
                    </div>
                    
                    <div class="competenza">
                        <h3>💪 Punti di Forza Identificati</h3>
                        ${generateStrengthsList(competenze)}
                    </div>
                    
                    <div class="competenza">
                        <h3>🎯 Aree di Sviluppo e Prossimi Passi</h3>
                        ${generateDevelopmentAreas(competenze)}
                    </div>
                    
                    <div class="competenza">
                        <h3>📝 Note del Sistema</h3>
                        <p><em>Questo report è stato generato dal Sistema Valutativo Inclusivo "Valutare l'Invisibile", basato sui principi di valutazione formativa di Black & Wiliam.</em></p>
                    </div>
                </body>
                </html>
                `;
                
                // Apri una nuova finestra con il contenuto PDF
                const printWindow = window.open('', '_blank');
                if (printWindow) {
                    printWindow.document.write(pdfContent);
                    printWindow.document.close();
                    printWindow.focus();
                    
                    // Attiva automaticamente la stampa
                    setTimeout(() => {
                        printWindow.print();
                    }, 500);
                }
                
                showNotification('📄 Report PDF generato!', 'success');
            }, 1500);
        }

        function generateStrengthsList(competenze) {
            const strengths = [];
            
            if (competenze.collaborazione >= 2.5) {
                strengths.push('<li><strong>Collaborazione efficace:</strong> Dimostra buone capacità di lavoro in gruppo</li>');
            }
            if (competenze.autonomia >= 2.5) {
                strengths.push('<li><strong>Crescente autonomia:</strong> Mostra progressi nell\'organizzazione del lavoro</li>');
            }
            if (competenze.resilienza >= 2.5) {
                strengths.push('<li><strong>Resilienza positiva:</strong> Affronta gli ostacoli con persistenza</li>');
            }
            if (competenze.metacognizione >= 2.0) {
                strengths.push('<li><strong>Consapevolezza metacognitiva:</strong> Sviluppa capacità di riflettere sul proprio apprendimento</li>');
            }
            if (competenze.creativita >= 2.5) {
                strengths.push('<li><strong>Pensiero creativo:</strong> Manifesta originalità nell\'approccio ai problemi</li>');
            }
            if (competenze.socioemotive >= 2.5) {
                strengths.push('<li><strong>Competenze socio-emotive:</strong> Buon riconoscimento e gestione delle emozioni</li>');
            }
            
            return strengths.length > 0 ? '<ul>' + strengths.join('') + '</ul>' : '<ul><li><strong>Potenziale in crescita:</strong> Tutti gli ambiti mostrano possibilità di sviluppo</li></ul>';
        }

        function generateDevelopmentAreas(competenze) {
            const areas = [];
            
            if (competenze.collaborazione < 2.5) {
                areas.push('<li><strong>Sviluppo collaborativo:</strong> Potenziare l\'ascolto attivo e la comunicazione</li>');
            }
            if (competenze.autonomia < 2.5) {
                areas.push('<li><strong>Crescita dell\'autonomia:</strong> Sviluppare strategie di pianificazione</li>');
            }
            if (competenze.resilienza < 2.5) {
                areas.push('<li><strong>Rafforzamento della resilienza:</strong> Costruire strategie per affrontare le sfide</li>');
            }
            if (competenze.metacognizione < 2.0) {
                areas.push('<li><strong>Consapevolezza metacognitiva:</strong> Sviluppare la riflessione sui processi di apprendimento</li>');
            }
            if (competenze.creativita < 2.5) {
                areas.push('<li><strong>Stimolazione creativa:</strong> Incoraggiare l\'espressione di idee originali</li>');
            }
            if (competenze.socioemotive < 2.5) {
                areas.push('<li><strong>Competenze socio-emotive:</strong> Rafforzare le abilità di gestione emotiva</li>');
            }
            
            return areas.length > 0 ? '<ul>' + areas.join('') + '</ul>' : '<ul><li><strong>Consolidamento:</strong> Mantenere i livelli raggiunti attraverso sfide progressive</li></ul>';
        }
        
        function showNotification(message, type = 'info') {
            // Rimuovi notifica esistente
            const existing = document.querySelector('.notification');
            if (existing) {
                existing.remove();
            }
            
            const colors = {
                success: '#d4edda',
                warning: '#fff3cd',
                info: '#d1ecf1',
                error: '#f8d7da'
            };
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: ${colors[type]};
                color: #333;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                max-width: 300px;
                font-size: 14px;
                border-left: 4px solid ${type === 'success' ? '#28a745' : type === 'warning' ? '#ffc107' : type === 'error' ? '#dc3545' : '#17a2b8'};
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Rimuovi dopo 3 secondi
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }

        // Gestione integrazione con Mappa Obiettivi
        function openObjectivesManager() {
            const objectivesWindow = window.open('mappa-obiettivi.html', 'MappaObiettivi', 
                'width=1200,height=800,scrollbars=yes,resizable=yes');
            
            if (!objectivesWindow) {
                showNotification('⚠️ Popup bloccato. Abilita i popup per aprire la mappa obiettivi.', 'warning');
                return;
            }
            
            // Listener per quando la finestra si chiude
            const checkClosed = setInterval(() => {
                if (objectivesWindow.closed) {
                    clearInterval(checkClosed);
                    setTimeout(() => {
                        syncObjectivesData();
                    }, 500);
                }
            }, 1000);
        }

        function syncObjectivesData() {
            try {
                // Verifica se localStorage è disponibile
                if (typeof Storage === 'undefined') {
                    console.log('localStorage non disponibile');
                    return; // Esce silenziosamente senza mostrare errori
                }
                
                const objectives = JSON.parse(localStorage.getItem('pei_objectives') || '[]');
                updateObjectivesSummary(objectives);
                updateObjectivesPreview(objectives);
                updateObjectivesChart(objectives);
                
                // Solo se ci sono effettivamente obiettivi mostra il messaggio di successo
                if (objectives.length > 0) {
                    showNotification('📊 Dati obiettivi aggiornati!', 'success');
                }
            } catch (error) {
                // Non mostra errori all'utente, solo log silenzioso
                console.log('Sincronizzazione obiettivi non necessaria');
            }
                renderDetailedObjectivesList();
                generateEnhancedInsights();
        }

        function updateObjectivesSummary(objectives) {
            const total = objectives.length;
            const completed = objectives.filter(obj => obj.status === 'acquisito').length;
            const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            const totalEl = document.getElementById('totalPeiObjectives');
            const completedEl = document.getElementById('completedPeiObjectives');
            const progressEl = document.getElementById('progressPeiObjectives');
            
            if (totalEl) totalEl.textContent = total;
            if (completedEl) completedEl.textContent = completed;
            if (progressEl) progressEl.textContent = progress + '%';
        }

        function updateObjectivesPreview(objectives) {
            const preview = document.getElementById('objectivesPreview');
            if (!preview) return;
            
            if (objectives.length === 0) {
                preview.innerHTML = `
                    <div class="empty-preview" style="text-align: center; padding: 20px; color: #6c757d;">
                        <div style="font-size: 48px; margin-bottom: 10px;">🎯</div>
                        <p>Nessun obiettivo definito</p>
                        <p style="font-size: 0.9em;">Clicca su "Gestisci Obiettivi PEI" per iniziare</p>
                    </div>
                `;
                return;
            }
            
            const firstFour = objectives.slice(0, 4);
            const statusLabels = {
                'acquisito': 'Acquisito',
                'consolidamento': 'In Consolidamento', 
                'emergente': 'Emergente',
                'avvio': 'In Avvio'
            };
            
            preview.innerHTML = firstFour.map(obj => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee;">
                    <span style="flex: 1; font-size: 0.9em;">${obj.title}</span>
                    <span style="padding: 2px 8px; border-radius: 12px; font-size: 0.8em; background: ${getStatusColor(obj.status)}; color: white;">
                        ${statusLabels[obj.status]}
                    </span>
                </div>
            `).join('') + (objectives.length > 4 ? 
                `<div style="text-align: center; margin-top: 15px; color: #6c757d; font-size: 0.85rem;">
                    ... e altri ${objectives.length - 4} obiettivi
                </div>` : '');
        }

        function getStatusColor(status) {
            const colors = {
                'acquisito': '#28a745',
                'consolidamento': '#ffc107',
                'emergente': '#fd7e14',
                'avvio': '#007bff'
            };
            return colors[status] || '#6c757d';
        }

        function updateObjectivesChart(objectives) {
            const canvas = document.getElementById('objectivesChart');
            if (!canvas) return;
            
            if (objectives.length === 0) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#6c757d';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Nessun obiettivo definito', canvas.width / 2, canvas.height / 2 - 10);
                ctx.font = '12px Arial';
                ctx.fillText('Aggiungi obiettivi per vedere il grafico', canvas.width / 2, canvas.height / 2 + 10);
                return;
            }
            
            // Calcola le statistiche
            const statusCounts = {
                'acquisito': 0,
                'consolidamento': 0,
                'emergente': 0,
                'avvio': 0
            };
            
            objectives.forEach(obj => {
                if (statusCounts.hasOwnProperty(obj.status)) {
                    statusCounts[obj.status]++;
                }
            });
            
            const data = [
                { label: 'Acquisito', value: statusCounts.acquisito, color: '#28a745' },
                { label: 'In Consolidamento', value: statusCounts.consolidamento, color: '#ffc107' },
                { label: 'Emergente', value: statusCounts.emergente, color: '#fd7e14' },
                { label: 'In Avvio', value: statusCounts.avvio, color: '#007bff' }
            ];
            
            const activeData = data.filter(d => d.value > 0);
            
            if (activeData.length > 0) {
                drawDonutChart(canvas, activeData, objectives.length);
            }
        }

        function drawDonutChart(canvas, data, total) {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const outerRadius = Math.min(centerX, centerY) - 20;
            const innerRadius = outerRadius * 0.6;
            
            let currentAngle = -Math.PI / 2;
            
            data.forEach(item => {
                const sliceAngle = (item.value / total) * 2 * Math.PI;
                
                // Disegna slice
                ctx.beginPath();
                ctx.arc(centerX, centerY, outerRadius, currentAngle, currentAngle + sliceAngle);
                ctx.arc(centerX, centerY, innerRadius, currentAngle + sliceAngle, currentAngle, true);
                ctx.closePath();
                ctx.fillStyle = item.color;
                ctx.fill();
                
                // Etichetta con valore
                if (item.value > 0) {
                    const labelAngle = currentAngle + sliceAngle / 2;
                    const labelRadius = (outerRadius + innerRadius) / 2;
                    const labelX = centerX + Math.cos(labelAngle) * labelRadius;
                    const labelY = centerY + Math.sin(labelAngle) * labelRadius;
                    
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.shadowColor = 'rgba(0,0,0,0.5)';
                    ctx.shadowBlur = 2;
                    ctx.fillText(item.value, labelX, labelY);
                    ctx.shadowBlur = 0;
                }
                
                currentAngle += sliceAngle;
            });
            
            // Testo centrale
            ctx.fillStyle = '#333';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(total, centerX, centerY - 5);
            
            ctx.font = '12px Arial';
            ctx.fillStyle = '#666';
            ctx.fillText('Obiettivi', centerX, centerY + 15);
        }

        // Listener per messaggi dalla mappa obiettivi
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'objectivesUpdated') {
                setTimeout(() => {
                    syncObjectivesData();
                }, 500);
            }
        });

        // Sincronizza i dati quando si torna alla dashboard
        window.addEventListener('focus', function() {
            setTimeout(() => {
                syncObjectivesData();
            }, 500);
        });

        // Test approfondito del sistema
        function testSystemFunctionality() {
            console.log('🔍 Test approfondito delle funzionalità...');
            
            const isMobile = window.innerWidth <= 768;
            console.log(`📱 Responsività: ${isMobile ? 'Mobile view attiva' : 'Desktop view'}`);
            
            const dsaFramework = document.querySelector('.disability-specific');
            console.log(`🎯 Framework DSA: ${dsaFramework ? 'Caricato correttamente' : 'Non trovato'}`);
            
            try {
                sessionStorage.setItem('test', 'ok');
                sessionStorage.removeItem('test');
                console.log('💾 Sistema salvataggio: Funzionante');
            } catch (e) {
                console.log('💾 Sistema salvataggio: Fallback attivo');
            }
            
            console.log(`📊 Chart.js: ${typeof Chart !== 'undefined' ? 'Caricato' : 'Non disponibile'}`);
            
            return true;
        }

        // Test al caricamento completo
        window.addEventListener('load', function() {
            setTimeout(() => {
                testSystemFunctionality();
                showNotification('🎯 Sistema "Valutare l\'Invisibile" completamente funzionale!', 'success');
            }, 1000);
        });

        // Gestione errori globale
        window.addEventListener('error', function(e) {
            console.error('Errore rilevato:', e.error);
            showNotification('⚠️ Errore rilevato. Sistema in modalità di recupero.', 'warning');
        });

        // Reset sistema per testing
        function resetSystem() {
            if (confirm('Sei sicuro di voler resettare tutti i dati?')) {
                document.querySelectorAll('.range-input').forEach(slider => {
                    slider.value = 2;
                    updateRange(slider);
                });
                
                document.querySelectorAll('textarea').forEach(textarea => {
                    if (!textarea.readOnly) {
                        textarea.value = '';
                    }
                });
                
                document.querySelectorAll('.selected').forEach(element => {
                    element.classList.remove('selected');
                });
                
                try {
                    sessionStorage.removeItem('valutazioniSalvate');
                } catch (e) {
                    console.log('Storage non disponibile');
                }
                
                updateDashboard();
                updateCharts();
                
                showNotification('🔄 Sistema resettato con successo!', 'info');
            }
        }

        // Aggiungi CSS per le animazioni
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            .notification {
                animation: slideIn 0.3s ease;
            }
        `;
        document.head.appendChild(style);

       // ========== NUOVE FUNZIONI PER LISTA DETTAGLIATA OBIETTIVI ==========
        
        // Funzione per renderizzare la lista dettagliata
        function renderDetailedObjectivesList() {
            try {
                const objectives = JSON.parse(localStorage.getItem('pei_objectives') || '[]');
                const container = document.getElementById('detailedObjectivesList');
                
                if (!container) return;
                
                const filteredObjectives = currentDetailedFilter === 'all' 
                    ? objectives 
                    : objectives.filter(obj => obj.status === currentDetailedFilter);

                if (filteredObjectives.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px 20px; color: #6c757d;">
                            <div style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;">🎯</div>
                            <p>Nessun obiettivo trovato per questo filtro</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = filteredObjectives.map(obj => `
                    <div class="objective-item-detailed status-${obj.status}">
                        <div class="progress-indicator-detailed ${obj.status}"></div>
                        <div class="objective-header-detailed">
                            <div class="objective-title-detailed">${obj.title}</div>
                            <div class="objective-status-detailed status-${obj.status}">
                                ${getDetailedStatusLabel(obj.status)}
                            </div>
                        </div>
                        
                        <div class="objective-meta-detailed">
                            <div class="meta-item-detailed">
                                <span style="font-size: 1rem;">📚</span>
                                <span>${getDetailedAreaLabel(obj.area)}</span>
                            </div>
                            <div class="meta-item-detailed">
                                <span style="font-size: 1rem;">⚡</span>
                                <span>Priorità ${obj.priority}</span>
                            </div>
                            ${obj.deadline ? `
                            <div class="meta-item-detailed">
                                <span style="font-size: 1rem;">📅</span>
                                <span>${formatDetailedDate(obj.deadline)}</span>
                            </div>
                            ` : ''}
                        </div>
                        
                        ${obj.description ? `
                        <div class="objective-description-detailed">
                            ${obj.description}
                        </div>
                        ` : ''}
                    </div>
                `).join('');
            } catch (error) {
                console.log('Errore rendering lista obiettivi:', error);
            }
        }

        // Funzione per filtrare obiettivi
        function filterDetailedObjectives(status) {
            currentDetailedFilter = status;
            
            // Aggiorna UI filtri
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Trova il tab cliccato e attivalo
            event.target.classList.add('active');
            
            // Re-render lista
            renderDetailedObjectivesList();
        }

        // Funzioni helper
        function getDetailedStatusLabel(status) {
            const labels = {
                'acquisito': 'Acquisito',
                'consolidamento': 'In Consolidamento',
                'emergente': 'Emergente',
                'avvio': 'In Avvio'
            };
            return labels[status] || status;
        }

        function getDetailedAreaLabel(area) {
            const labels = {
                'cognitiva': 'Area Cognitiva',
                'comunicativa': 'Area Comunicativa',
                'sociale': 'Area Sociale',
                'autonomia': 'Autonomia Personale',
                'motoria': 'Area Motoria',
                'sensoriale': 'Area Sensoriale',
                'socioemotive': 'Socio-Emotive'
            };
            return labels[area] || area;
        }

        function formatDetailedDate(dateString) {
            return new Date(dateString).toLocaleDateString('it-IT');
        }

        // Funzione per insights migliorati
        function generateEnhancedInsights() {
            try {
                const objectives = JSON.parse(localStorage.getItem('pei_objectives') || '[]');
                const container = document.getElementById('enhancedInsights');
                
                if (!container || objectives.length === 0) {
                    if (container) {
                        container.innerHTML = '<div class="insight-item-enhanced"><span>📊</span><span>Nessun dato disponibile per gli insights</span></div>';
                    }
                    return;
                }
                
                const statusCounts = {
                    acquisito: 0,
                    consolidamento: 0,
                    emergente: 0,
                    avvio: 0
                };
                
                objectives.forEach(obj => {
                    if (statusCounts.hasOwnProperty(obj.status)) {
                        statusCounts[obj.status]++;
                    }
                });
                
                const total = objectives.length;
                const acquired = statusCounts.acquisito;
                const insights = [];
                
                // Insights basati sui dati reali
                if (acquired === 0) {
                    insights.push({
                        icon: '🎯',
                        text: 'Nessun obiettivo ancora acquisito - Valutare strategie di supporto personalizzate'
                    });
                } else {
                    const acquiredTitles = objectives
                        .filter(obj => obj.status === 'acquisito')
                        .map(obj => obj.title.length > 40 ? obj.title.substring(0, 40) + '...' : obj.title)
                        .slice(0, 2); // Mostra max 2 titoli
                    
                    insights.push({
                        icon: '🌟',
                        text: `${acquired} obiettivi acquisiti: ${acquiredTitles.join(', ')}${acquired > 2 ? ' e altri...' : ''}`
                    });
                }
                
                // Analisi priorità
                const highPriorityInProgress = objectives.filter(obj => 
                    obj.priority === 'alta' && obj.status !== 'acquisito'
                ).length;
                
                if (highPriorityInProgress > 0) {
                    insights.push({
                        icon: '⚡',
                        text: `${highPriorityInProgress} obiettivi ad alta priorità necessitano ancora supporto`
                    });
                }
                
                // Analisi scadenze
                const nearDeadline = objectives.filter(obj => {
                    if (!obj.deadline) return false;
                    const deadline = new Date(obj.deadline);
                    const now = new Date();
                    const daysUntil = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));
                    return daysUntil <= 30 && daysUntil > 0 && obj.status !== 'acquisito';
                });
                
                if (nearDeadline.length > 0) {
                    insights.push({
                        icon: '⏰',
                        text: `${nearDeadline.length} obiettivi in scadenza nel prossimo mese`
                    });
                }
                
                // Raccomandazioni
                const percentage = Math.round((acquired / total) * 100);
                if (percentage >= 50) {
                    insights.push({
                        icon: '✅',
                        text: 'Progresso solido - Considerare introduzione di obiettivi più sfidanti'
                    });
                } else if (percentage > 0) {
                    insights.push({
                        icon: '🔄',
                        text: 'Progresso in corso - Continuare con le strategie attuali'
                    });
                } else {
                    insights.push({
                        icon: '🚀',
                        text: 'Fase iniziale - Opportunità per definire strategie didattiche mirate'
                    });
                }
                
                container.innerHTML = insights.map(insight => `
                    <div class="insight-item-enhanced">
                        <span style="font-size: 1.1rem;">${insight.icon}</span>
                        <span>${insight.text}</span>
                    </div>
                `).join('');
                
            } catch (error) {
                console.log('Errore generazione insights:', error);
            }
        }
        
    </script>
</body>
</html>
